# 前端工程化实操

tools list: 
- commitlint
- commitizen
- conventional-changelog-atom
- cz-conventional-changelog
- cz-customizable

## 小记

git 提交规范：`type(scope): subject`，记住subject之前有空格

## husky

> https://typicode.github.io/husky/getting-started.html

定义：当在git commit或git push时，可以进行格式化git提交消息、运行脚本、格式化代码等

特性：
- 轻量、0依赖
- 由git特性core.hooksPath驱动
- 输入输出型
- 用户提示
- 支持各大OS、git gui、自定义hooks目录、嵌套的项目、monorepos

## 用法

- 在hooks中添加`exit 1`会提前终止命令

### 自动安装（建议）

使用以下命令快速集成husky，安装后将自动添加：
- 在package.json添加prepare script
- 生成.husky目录，并创建一个pre-commit hook文件
- 配置git hooks路径

<!-- tabs:start -->
<!-- tab:npm -->
```bash
npx husky-init && npm install
```

<!-- tab:pnpm -->
```bash
pnpm dlx husky-init && pnpm install
```

<!-- tab:yarn -->
```bash
yarn dlx husky-init --yarn2 && yarn
```
<!-- tabs:end -->

### 手动安装

第一步：安装husky

<!-- tabs:start -->
<!-- tab:npm -->
```bash
npm install husky -D
```

<!-- tab:yarn -->
```bash
yarn add husky --dev
# 安装它以替代prepare script
yarn add pinst --dev
```
<!-- tabs:end -->

第二步：开启git hooks

<!-- tabs:start -->
<!-- tab:npm -->
```bash
npx husky install

# 该命令会生成下面的结构
# --root（项目根目录）
# ----.husky
# ------_
# --------.gitignore
# --------husky.sh
```

<!-- tab:yarn -->
```bash
yarn husky install
```
<!-- tabs:end -->

第三步：在package.json中定义一个prepare script，在npm install时自动启动git hooks（即第二步的内容）

<!-- tabs:start -->
<!-- tab:npm -->
```bash
# 也可以在package.json中直接添加
npm pkg set scripts.prepare="husky install"
```

<!-- tab:yarn -->
```json
{
  // 私有包配置
  "private": true,
  "scripts": {
    "postinstall": "husky install"
  },

  // 公有包配置
  "private": false,
  scripts: {
    "postinstall": "husky install",
    "prepack": "pinst --disable",
    "postpack": "pinst --enable"
  }
}
```
<!-- tabs:end -->

第四步：使用`npx husky add <file_path> [cmd]`创建一个hook，一般file_path在.husky目录下。你也可以自行创建文件添加内容。

```bash
# 添加pre-commit hook，值为npm test
npx husky add .husky/pre-commit "npm test"

# 该命令会创建.husky/pre-commit文件，生成以下内容：
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npm test
```

第五步：在上面四步走完后，husky拦截git commit就生效了，在：

```bash
git add .
# git commit会被拦截
git commit -m '提交说明'
```

### 卸载

<!-- tabs:start -->
<!-- tab:npm -->
```bash
npm uninstall husky && git config --unset core.hooksPath
```

<!-- tab:yarn -->
```bash
yarn remove husky && git config --unset core.hooksPath
```
<!-- tabs:end -->

### 将husky存放在其他地方

默认情况下，husky相关的配置是存在root/.husky/目录下的，若你想更改目录，则需要修改package.json的配置。若husky存放在项目root之外的地方，需要修改hooks的内容，在执行命令前添加`cd front`，表明husky脚本的位置

```json
{
  "scripts": {
    // 添加存放的目录：将.husky => .config/husky
    "prepare": "husky install .config/husky"

    // 存放在项目之外：将.husky => ../front/.husky
    "prepare": "cd .. && husky install front/.husky"
  }
}
```

### 跳过husky拦截

```bash
# 添加 --no-verify 选项参数
git commit -m '提交说明' --no-verify
```
