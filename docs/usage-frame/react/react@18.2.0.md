# react@18.2.0

## hook

æ³¨æ„ï¼šæ‰€æœ‰çš„hookéƒ½åªèƒ½å¤Ÿåœ¨ç»„ä»¶é¡¶å±‚å’Œè‡ªå®šä¹‰çš„hookä¸­è°ƒç”¨ï¼Œä¸”åœ¨å¼€å‘ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œè°ƒç”¨ä¸¤æ¬¡ç»„ä»¶æ–¹æ³•

### useState

ä½œç”¨ï¼šç»™ç»„ä»¶æ·»åŠ ä¸€ä¸ªæœ‰çŠ¶æ€çš„å˜é‡ï¼ˆå³ä¿æŒå˜é‡çš„å“åº”æ€§ï¼‰

å®šä¹‰ï¼š`const [state, setState] = useState(initialState)`

å®šä¹‰è¯´æ˜ï¼š

1. initialStateï¼šå³å˜é‡stateçš„åˆå§‹å€¼
   - å¯ä»¥æ˜¯ä»»æ„çš„å€¼ï¼ŒåŒ…æ‹¬å‡½æ•°
   - å¯¹äºå‡½æ•°ï¼Œå¿…é¡»æ˜¯æ— å‚æ•°çš„çº¯å‡½æ•°ï¼Œä¼šå°†è¯¥å‡½æ•°çš„è¿è¡Œç»“æœä½œä¸ºstateçš„åˆå§‹å€¼
   - åˆå§‹åŒ–å®Œæˆä¹‹åï¼Œè¯¥å€¼å°±æ— ä½œç”¨äº†ã€‚åç»­å¦‚æœpropsã€stateç­‰å˜æ›´åˆ°å¯¼è‡´é‡æ¸²æŸ“ï¼Œè¯¥å€¼ä¹Ÿä¸ä¼šå‘æŒ¥ä»»ä½•ä½œç”¨ã€‚ä»…åœ¨é¦–æ¬¡æ¸²æŸ“æœ‰ä½œç”¨
2. è¿”å›å€¼ï¼šè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªç”±ä¸¤ä¸ªå€¼ç»„æˆçš„æ•°ç»„
   - stateï¼šåœ¨é¦–æ¬¡æ¸²æŸ“æ—¶ï¼Œä¹Ÿå°±æ˜¯initialState
   - setå‡½æ•°ï¼ˆsetStateï¼‰ï¼šæ›´æ–°stateçš„å‡½æ•°ï¼Œæ— è¿”å›å€¼ï¼Œåœ¨æ›´æ–°æ—¶åŒæ—¶è§¦å‘ç»„ä»¶é‡æ¸²æŸ“
   - setStateçš„å‚æ•°ï¼šå¯ä»¥æ˜¯ä¸€ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªçº¯å‡½æ•°`prev => cur`ï¼ˆæ ¹æ®ä¹‹å‰çš„stateè®¡ç®—å‡ºç°åœ¨çš„stateï¼‰

æ³¨æ„ï¼š

- hookåªèƒ½åœ¨ç»„ä»¶çš„é¡¶å±‚æˆ–è‡ªå·±çš„hookä¸­è°ƒç”¨ï¼Œä¸èƒ½ç”¨äºå¾ªç¯æˆ–æ¡ä»¶è¯­å¥ä¸­
- ğŸ”´å¯ä»¥ä¼ é€’ä¸€ä¸ªå‡½æ•°å`fn`ä½œä¸ºåˆå§‹åŒ–å‚æ•°ï¼ˆä»…åœ¨åˆå§‹åŒ–æœŸé—´è°ƒç”¨ï¼‰ï¼Œè‹¥ä¼ é€’ä¸€ä¸ªå‡½æ•°çš„è°ƒç”¨`fn()`ä½œä¸ºå‚æ•°ï¼Œåˆ™æ¯æ¬¡é‡æ¸²æŸ“éƒ½ä¼šè¿›è¡Œè°ƒç”¨ï¼ˆå¦‚æœå‡½æ•°æ‰§è¡Œçš„æ—¶é—´è¿‡é•¿ï¼Œåˆ™å®¹æ˜“é˜»å¡é¡µé¢æ¸²æŸ“ï¼Œé€ æˆæ€§èƒ½æµªè´¹ï¼‰
- è‹¥stateæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™åœ¨æ›´æ–°çš„æ—¶å€™ï¼Œåº”è¯¥ä½¿ç”¨ç®­å¤´å‡½æ•°çš„æ–¹å¼`setFn(() => newFn)`ï¼Œå› ä¸ºé»˜è®¤çš„ç›´æ¥ä¼ å‡½æ•°åæ–¹å¼`setFn(newFn)`ï¼Œä¼šå°†å…¶å½“ä½œåˆå§‹åŒ–å‡½æ•°ã€‚
- setå‡½æ•°å‚æ•°è‹¥æ˜¯ä¾æ®ä¹‹å‰çŠ¶æ€è®¡ç®—çš„è¡¨è¾¾å¼`setCount(count + 1)`ï¼Œè‹¥è¿ç»­è°ƒç”¨å¤šæ¬¡ï¼Œåˆ™å®é™…ä¸Šå°±åªè°ƒç”¨äº†ä¸€æ¬¡ï¼ˆæ‰¹é‡çŠ¶æ€æ›´æ–°ç­–ç•¥çš„ç¼˜æ•…ï¼‰ï¼›è‹¥å‚æ•°æ˜¯å‡½æ•°`setCount(prev => prev + 1)`ï¼Œè¿ç»­è°ƒç”¨å¤šæ¬¡ï¼Œå®é™…ä¹Ÿæ˜¯è°ƒç”¨å¤šæ¬¡
- setå‡½æ•°ä»…æ›´æ–°ä¸‹ä¸€æ¬¡æ¸²æŸ“çš„çŠ¶æ€å˜é‡ï¼Œå³åœ¨è°ƒç”¨è¯¥å‡½æ•°ä¹‹åç´§æ¥ç€è°ƒç”¨è¯¥çŠ¶æ€å˜é‡ï¼Œå¾—åˆ°çš„å€¼è¿˜æ˜¯åŸæ¥çš„å€¼
- å¦‚æœæä¾›çš„æ–°å€¼å’Œä¸Šä¸€ä¸ªç›¸åŒï¼ˆæŒ‡çš„æ˜¯å¼•ç”¨ç›¸åŒï¼Œå³å†…å­˜ä¸­çš„åœ°å€ï¼‰ï¼Œå°†è·³è¿‡ç»„ä»¶é‡æ¸²æŸ“
- ç»™ç»„ä»¶ä¼ é€’ä¸€ä¸ªkeyï¼Œkeyæ”¹å˜æ—¶ï¼Œå¯ä»¥é‡ç½®ç»„ä»¶çš„çŠ¶æ€ï¼ˆå³é‡æ–°è¿›è¡Œåˆå§‹åŒ–æ¸²æŸ“ï¼‰
- å½“æ›´æ–°ä¸€ä¸ªå¯¹è±¡/æ•°ç»„æ—¶`setObj(newObj)`ï¼Œè¯·è¿›è¡Œæ•´ä¸ªæ›¿æ¢`setObj({...newObj})`ï¼ˆä¹Ÿå°±æ˜¯å¼•ç”¨ä¹Ÿéšä¹‹å˜æ›´ï¼Œå¯ä½¿ç”¨å±•å¼€è¯­æ³•å¤åˆ¶å¯¹è±¡å’Œæ•°ç»„ã€concatæ·»åŠ ã€filteråˆ é™¤ã€sliceæˆªå–ã€mapç­‰æ”¹å˜æ•°ç»„ï¼‰ï¼Œè€Œéä½¿ç”¨ä¸æ”¹å˜å¯¹è±¡å¼•ç”¨çš„æ–¹å¼ï¼ˆæ¯”å¦‚æ•°ç»„çš„pushç­‰ã€ç›´æ¥è®¾ç½®å±æ€§ç­‰ï¼‰æ”¹å˜å¯¹è±¡ï¼Œä¸ç„¶å±å¹•å¯èƒ½ä¸ä¼šæ›´æ–°ã€‚å¯¹äºå¤æ‚çš„å¯¹è±¡æˆ–æ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨[`immer`](https://zh-hans.react.dev/learn/updating-arrays-in-state#write-concise-update-logic-with-immer)è¿›è¡Œä¿®æ”¹ï¼Œè®©ä¿®æ”¹æ“ä½œæ›´åŠ ç®€æ´
- reactæ‰§è¡Œçš„æ˜¯æ‰¹é‡çŠ¶æ€æ›´æ–°ç­–ç•¥ï¼Œå³è°ƒç”¨setå‡½æ•°åä¸ä¼šç«‹å³æ‰§è¡Œæ›´æ–°ï¼Œè€Œæ˜¯ç­‰å¾…æ‰€æœ‰çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼ˆæ¯”å¦‚ç‚¹å‡»ï¼Œæ¢å¥è¯è¯´ï¼Œå¾—ç­‰å¾…setå‡½æ•°æ‰€å¤„çš„å—ä»£ç æ‰§è¡Œå®Œæ¯•ï¼‰æ‰§è¡Œå®Œæ¯•åæ‰ä¼šæ›´æ–°çŠ¶æ€ï¼ˆä¹Ÿå°±æ˜¯ç»„ä»¶é‡æ¸²æŸ“æ›´æ–°å±å¹•ï¼‰ã€‚å¦‚æœä½ æƒ³è°ƒç”¨setå‡½æ•°åè¿«åˆ‡çš„æ›´æ–°å±å¹•ï¼ˆè®¿é—®domï¼‰ï¼Œå¯ä»¥ä½¿ç”¨flushSyncï¼ˆå½±å“æ€§èƒ½ï¼Œå¤§å¤šæ•°æ—¶å€™éƒ½ä¸ç”¨ï¼‰
- åœ¨è°ƒç”¨setå‡½æ•°çš„ä»£ç å—ä¸­åŒ…æ‹¬å¼‚æ­¥æ“ä½œï¼Œè‹¥å¼‚æ­¥æ“ä½œå†…éƒ¨ä¹ŸåŒ…æ‹¬stateå˜é‡ï¼Œå˜é‡çš„å€¼è¿˜æ˜¯ä¹‹å‰çš„ï¼Œreactæ‰§è¡Œçš„æ˜¯æ‰¹é‡çŠ¶æ€æ›´æ–°ç­–ç•¥ï¼Œä¸å½±å“å·²ç»è¿è¡Œçš„äº‹ä»¶å¤„ç†ç¨‹åºä¸­çš„å˜é‡çš„å€¼ï¼ˆå³ä½¿æ˜¯å¼‚æ­¥çš„ï¼‰
- ğŸ”´ğŸ¡è‹¥å‡ºç°`Too many re-renders. React limits the number of renders to prevent an infinite loop.`çš„é”™è¯¯ï¼Œè¡¨æ˜æ­¤æ—¶ç»„ä»¶è¿›è¡Œå¾ªç¯`æ¸²æŸ“->è®¾ç½®çŠ¶æ€ï¼ˆé‡æ¸²æŸ“ï¼‰-> æ¸²æŸ“`çš„å¾ªç¯ç­‰ï¼Œéœ€è¦æ³¨æ„ä¸‹åˆ—æƒ…å½¢ï¼š
  - é”™è¯¯æŒ‡å®šäº‹ä»¶å¤„ç†å‡½æ•°å¼•èµ·çš„(å³`onClick={handleClick()}`)ï¼Œåœ¨æ¸²æŸ“æœŸé—´å¤§æ‹¬å·çš„ä»£ç ä¼šç«‹å³æ‰§è¡Œï¼ˆæ¯”å¦‚è¯¥å‡½æ•°åŒ…å«dispatchï¼Œä¼šå¯¼è‡´ä¸€æ¬¡é‡æ¸²æŸ“ï¼ˆç„¶åè¿›è¡Œæ— é™å¾ªç¯ï¼šdispatchã€æ¸²æŸ“ã€dispatch...ï¼‰ï¼‰ï¼Œæ­£ç¡®çš„å¤„ç†æ˜¯`onClick={handleClick}`æˆ–`onClick={(e) => handleClick(e)}`ã€‚ä¹Ÿå¯æŸ¥çœ‹æ§åˆ¶å°çš„JavaScriptè°ƒç”¨å †æ ˆ
  - å½“ä¸€ä¸ªstateçš„çŠ¶æ€ä¾èµ–äºå…¶ä»–stateçŠ¶æ€çš„å˜æ›´ï¼Œåº”è¯¥æ³¨æ„ï¼Œåœ¨ç»„ä»¶é¡¶å±‚ä½œç”¨åŸŸä¸­ï¼Œåº”è¯¥åœ¨æŸç§æ¡ä»¶ä¸‹ä¿®æ”¹stateçš„å˜æ›´
- åœ¨å¼€å‘ä¸”ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå°†ä¸¤æ¬¡è°ƒç”¨åˆå§‹åŒ–å‡½æ•°ï¼Œç”¨äºæ‰¾å‡ºæ„å¤–çš„ä¸çº¯æ€§

```javascript
function Messsage({messageColor}) {
   // å°†propsä½œä¸ºåˆå§‹å€¼ï¼Œä»…åœ¨é¦–æ¬¡æ¸²æŸ“æ—¶æœ‰æ•ˆï¼Œåœ¨åç»­propså˜æ›´æ—¶ï¼Œä¸ä¼šå‘ç”Ÿé‡æ¸²æŸ“
   // è‹¥ä»…ä»…å°†å…¶å½“ä½œåˆå§‹å€¼ï¼Œåé¢æ›´æ–°éƒ½è·Ÿå…¶æ— å…³çš„è¯ï¼Œé‚£è¿™æ ·åšæ˜¯æœ‰ç”¨çš„
   const [color, setColor] = useState(messageColor)

   // æ­£ç¡®åšæ³•ï¼Œæƒ³åœ¨æ¯æ¬¡propsæ›´æ–°éƒ½æ›´æ–°
   const color = messageColor
}

// ğŸ”´ğŸ¡
function CountLabel ({ count }) {
   const [prevCount, setPrevCount] = useState(count)
   const [trend, setTrend] = useState(null)

   // æ³¨æ„ï¼Œåœ¨é¡¶å±‚ä½œç”¨åŸŸä¸­ï¼Œå¿…é¡»æ ¹æ®æ¡ä»¶ä¿®æ”¹ï¼Œå¦åˆ™ä¸€ç›´é‡æ¸²æŸ“å¯¼è‡´æŠ¥é”™
   if (preCount !== count) {
      setPrevCount(count)
      setTrend(count > prevCount ? 'up' : 'down')
   }

   function getCount () {
      return count
   }

   return (<div onClick={getCount}>...</div>)
   return (<div onClick={() => getCount()}></div>)
   // warn: è¿™ç§ç”¨æ³•ä¹Ÿä¼šå¯¼è‡´é‡æ¸²æŸ“å¤šæ¬¡
   return (<div onClick={getCount()})></div>
}

```

### useEffect

ä½œç”¨ï¼šå°†ç»„ä»¶ä¸å¤–éƒ¨ç³»ç»Ÿï¼ˆä¸å—reactæ§åˆ¶çš„å†…å®¹ï¼Œæ¯”å¦‚web apiã€httpã€ç¬¬ä¸‰æ–¹åº“ç­‰ï¼‰åŒæ­¥

å®šä¹‰ï¼š`useEffect(setup, dependencies?)`

å®šä¹‰è¯´æ˜ï¼š

1. setup: å¤„ç† effect çš„å‡½æ•°ï¼Œé€‰æ‹©æ€§è¿”å›ä¸€ä¸ªæ¸…ç†å‡½æ•° cleanup
   - åœ¨ç»„ä»¶è¢«æ·»åŠ åˆ° dom æ—¶ï¼Œå°†è¿è¡Œ setup
   - åœ¨ä¾èµ–é¡¹å˜æ›´å¯¼è‡´é‡æ¸²æŸ“åï¼Œå°†ç”¨æ—§å€¼è¿è¡Œ cleanupï¼Œåç”¨æ–°å€¼è¿è¡Œ setup
   - åœ¨ç»„ä»¶ä» dom ä¸­ç§»é™¤åï¼Œå°†è¿è¡Œ cleanup
2. dependencies?: setup å†…éƒ¨å¼•ç”¨çš„æ‰€æœ‰å“åº”å¼å€¼çš„åˆ—è¡¨ï¼ˆpropsã€stateã€æ‰€æœ‰ç›´æ¥åœ¨ç»„ä»¶å†…éƒ¨å£°æ˜çš„å˜é‡å’Œå‡½æ•°ï¼‰
   - ä¾èµ–é¡¹åˆ—è¡¨çš„å…ƒç´ æ•°é‡å¿…é¡»å›ºå®š
   - ä½¿ç”¨ Object.is æ¯”è¾ƒä¾èµ–é¡¹å’Œå…¶å…ˆå‰çš„å€¼
   - çœç•¥å‚æ•°ï¼Œåˆ™åœ¨é‡æ¸²æŸ“åï¼Œé‡æ–°è¿è¡Œ effectï¼ˆsetupï¼‰
   - è‹¥effectå†…éƒ¨ä»£ç ä¸ä½¿ç”¨ä»»æ„å“åº”å¼å€¼ï¼Œåˆ™ä¾èµ–é¡¹åˆ—è¡¨ä¸ºç©ºæ•°ç»„ï¼Œæ­¤æ—¶ç»„ä»¶çš„propsã€stateå˜æ›´æ—¶ï¼Œè¯¥ effect ä¸ä¼šé‡æ–°è¿è¡Œ
3. setup çš„è¿”å›å€¼`cleanup`çš„ä½œç”¨ï¼šä¸ setup é€»è¾‘å¯¹ç§°ï¼Œç”¨äºåœæ­¢/æ’¤é”€ setup åšçš„äº‹æƒ…

æ³¨æ„ï¼š

- åªèƒ½åœ¨ç»„ä»¶é¡¶å±‚æˆ–è‡ªå·±çš„ hook ä¸­è°ƒç”¨ï¼Œä¸èƒ½åœ¨å¾ªç¯/æ¡ä»¶å†…éƒ¨è°ƒç”¨ï¼ˆå¯æŠ½ç¦»æ–°ç»„ä»¶ï¼Œåœ¨å…¶å†…éƒ¨è°ƒç”¨ï¼‰
- å¦‚æœ setup å†…çš„ä»£ç ä¸ä½¿ç”¨ä»»ä½•å“åº”å¼å€¼ï¼Œåˆ™å…¶ä¾èµ–é¡¹åˆ—è¡¨åº”ä¸ºç©ºæ•°ç»„ï¼Œæ­¤æ—¶åœ¨ç»„ä»¶çš„ propsã€state å˜æ›´æ—¶ï¼Œè¯¥ setup å‡½æ•°ä¸ä¼šé‡æ–°æ‰§è¡Œ
- å½“ä¸ä¼ é€’ä¾èµ–æ•°ç»„æ—¶ï¼ˆå³è¯¥å‚æ•°å®Œå…¨çœç•¥ï¼‰ï¼Œsetup å‡½æ•°ä¼šåœ¨ç»„ä»¶æ¯æ¬¡å•ç‹¬æ¸²æŸ“/é‡æ–°æ¸²æŸ“ï¼ˆå³æ‰€æœ‰çš„å“åº”å¼å€¼å¯¼è‡´çš„ç»„ä»¶é‡æ¸²æŸ“ï¼‰ä¹‹åè¿è¡Œ
- æ— æ³•é€‰æ‹© effect çš„ä¾èµ–é¡¹ï¼Œåœ¨ setup å†…éƒ¨ä½¿ç”¨çš„æ¯ä¸ªå“åº”å¼å€¼éƒ½å¿…é¡»å£°æ˜ä¸ºä¾èµ–é¡¹ã€‚æ¢è¨€ä¹‹ï¼Œå¦‚æœæŸä¸ª setup å†…éƒ¨ä½¿ç”¨åˆ°çš„å€¼ä¸éœ€è¦ä½œä¸ºä¸€ä¸ªä¾èµ–é¡¹ï¼Œåˆ™å¯ä»¥å£°æ˜åœ¨ç»„ä»¶ï¼ˆå‡½æ•°ï¼‰å¤–éƒ¨ï¼Œè¡¨ç¤ºè¯¥å€¼æ˜¯éå“åº”å¼çš„ï¼Œåœ¨é‡æ¸²æŸ“æ—¶ä¸ä¼šå‘ç”Ÿå˜åŒ–
- è‹¥ä¾èµ–é¡¹æ˜¯ç»„ä»¶å†…éƒ¨å®šä¹‰çš„å¯¹è±¡/å‡½æ•°ï¼Œå¯èƒ½ä¼šå¯¼è‡´ effectï¼ˆsetupï¼‰è¿‡å¤šçš„é‡æ–°è¿è¡Œã€‚æ‰€ä»¥åº”è¯¥åˆ é™¤ä¸å¿…è¦çš„å¯¹è±¡/å‡½æ•°ä¾èµ–é¡¹ï¼Œæˆ–è€…æŠ½ç¦»çŠ¶æ€æ›´æ–°å’Œéå“åº”å¼é€»è¾‘åˆ° effect å¤–éƒ¨ï¼Œæˆ–è€…å°†å‡½æ•°å®šä¹‰åœ¨ setup å†…éƒ¨
- è‹¥éœ€è¦è·Ÿè¸ªä¸€äº›ä¸ç”¨äºæ¸²æŸ“çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ ref`useRef`è°ƒç”¨ï¼Œè¿™ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“
- è‹¥ setup å†…éƒ¨å…·æœ‰å¤šä¸ªå“åº”å¼å˜é‡ï¼ŒæŒ‰ç†æ¥è¯´ï¼Œå¿…é¡»æ·»åŠ æ‰€æœ‰å˜é‡åˆ°ä¾èµ–æ•°ç»„ä¸­ï¼Œè¿™åœ¨ä½ ä»…éœ€è¦ä¾èµ–ä¸€ä¸ªå“åº”å¼å˜é‡ä½†åˆéœ€è¦å…¶ä»–å€¼çš„æ—¶å€™æ˜æ˜¾åšä¸åˆ°ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ Effect äº‹ä»¶`useEffectEvent hook`ï¼Œå°†è¯»å–å…¶ä»–å€¼çš„ä»£ç æ”¾å…¥è¯¥ hook ä¸­ï¼Œç„¶ååœ¨ setup ä¸­è°ƒç”¨è¯¥ hook å³å¯ ğŸ“•ğŸ“•(â›” å®éªŒæ€§ api)
- é¿å…ä¸å¿…è¦çš„è¿›è¡Œæ›´æ–°ï¼Œå¤§å¤šæ•°æ€§èƒ½é—®é¢˜éƒ½æ˜¯ç”±effectåˆ›é€ çš„æ›´æ–°é“¾ï¼ˆå¯¼è‡´åå¤é‡æ–°æ¸²æŸ“ï¼‰å¼•èµ·çš„
- éäº¤äº’ï¼ˆç‚¹å‡»ï¼‰å¼•èµ·çš„ effect è¿è¡Œï¼Œä¼šè®©æµè§ˆå™¨åœ¨è¿è¡Œ effect å‰ç»˜åˆ¶å‡ºæ›´æ–°åçš„å±å¹•
- äº¤äº’å¼•èµ·çš„ effect è¿è¡Œï¼Œä¹Ÿå¯èƒ½ä¼šåœ¨è¿è¡Œ effect å‰é‡ç»˜å±å¹•ã€‚å½“è¦é˜»æ­¢å±å¹•é‡ç»˜ï¼Œåº”ä½¿ç”¨ useLayoutEffect ä»£æ›¿ useEffect
- è§†è§‰ç›¸å…³çš„äº‹æƒ…ï¼ˆå¦‚å®šä½ï¼‰ä¸”æœ‰æ˜æ˜¾çš„å»¶è¿Ÿï¼Œåº”ä½¿ç”¨ useLayoutEffect ä»£æ›¿ useEffect
- ä»…åœ¨å®¢æˆ·ç«¯ï¼ˆé ssrï¼‰è¿è¡Œï¼Œæ‰€ä»¥å¯èƒ½é€šè¿‡è¿™useEffectå†…ä¿®æ”¹å˜é‡æ ‡å¿—ï¼Œç„¶ååœ¨åçš„ä»£ç ä¸­æ¥åˆ†åˆ«è¿è¡Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„å†…å®¹
- åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œä¼šåœ¨ setup é¦–æ¬¡è¿è¡Œå‰ï¼Œé¢å¤–è¿è¡Œä¸€æ¬¡ setup å’Œ cleanupï¼Œè¿™æ˜¯ä¸€ä¸ªå‹åŠ›æµ‹è¯•ï¼Œç”¨äºéªŒè¯ effect é€»è¾‘æ˜¯å¦æ­£ç¡®å®ç°ã€‚è‹¥æ­¤æ—¶å‡ºç°é—®é¢˜ï¼Œåˆ™è¡¨æ˜ cleanup å‡½æ•°ç¼ºå°‘ä¸€äº›é€»è¾‘
- åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¸­æ˜¾ç¤ºä¸åŒçš„å†…å®¹ï¼Œå¯é€šè¿‡ effect å®ç°ï¼Œå°†æŸä¸ªæ ‡å¿—æ€§å˜é‡ç½®ä¸ºçœŸå€¼ï¼ˆå› ä¸º effect åœ¨æœåŠ¡å™¨æ˜¯ä¸å¯ç”¨çš„ï¼Œæ‰€ä»¥æ­¤ä»…åœ¨å®¢æˆ·ç«¯å¯ç”¨ï¼‰ï¼Œä¹‹åå°†è¿è¡Œä½ ç¼–å†™çš„çœŸå€¼æ¡ä»¶ä¸‹çš„ä»£ç ã€‚è‹¥ç”¨æˆ·ç½‘ç»œç¯å¢ƒç¼“æ…¢ï¼Œå°†ä¸€ç›´æ˜¾ç¤ºåˆå§‹ä»£ç ï¼Œå¯èƒ½é€ æˆä¸è‰¯å½±å“ã€‚è®¸å¤šæƒ…å†µä¸‹ï¼Œå¯é€šè¿‡ css æ¡ä»¶æ˜¾ç¤ºä¸åŒå†…å®¹

ç”¨æ³•ï¼š

1. è¿æ¥åˆ°å¤–éƒ¨ç³»ç»Ÿï¼ˆç½‘ç»œã€æµè§ˆå™¨ APIã€ç¬¬ä¸‰æ–¹åº“ï¼‰
   - éœ€è¦åœ¨ç»„ä»¶é¡¶å±‚è°ƒç”¨ useEffect

::: code-group

```javascript [setupå†…éƒ¨ä»…ä¾èµ–ä¸€ä¸ªå€¼]
// setupå†…éƒ¨ä»…ä¾èµ–ä¸€ä¸ªå€¼ï¼Œä½†åˆè¦è¯»å–å…¶ä»–å€¼â›”å®éªŒæ€§api
function Page({ url, shoppingCart }) {
  // å®šä¹‰ä¸€ä¸ªeffectäº‹ä»¶
  const onVisit = useEffectEvent((visitedUrl) => {
    // æ­¤å¤„å¤„ç†ç›¸å…³ä»£ç ï¼Œä¾‹å¦‚è¯»å–shoppingCart
    console.log(shoppingCart);
  });

  useEffect(() => {
    onVisit(url);
    // æ­¤å¤„ä»…ä»…éœ€è¦å°†urlæ·»åŠ åˆ°ä¾èµ–æ•°ç»„ä¸­ï¼Œè€ŒshoppingCartä¸éœ€è¦
  }, [url]);
}
```

:::

### useMemo

ä½œç”¨ï¼šç¼“å­˜è®¡ç®—çš„ç»“æœmï¼ˆé€šå¸¸ç¼“å­˜å˜é‡ï¼Œè™½ç„¶è¯´å¯ä»¥ç¼“å­˜å‡½æ•°å’ŒJSXèŠ‚ç‚¹ï¼‰ï¼Œåœ¨ç»„ä»¶é‡æ¸²æŸ“æ—¶ï¼Œè‹¥ä¾èµ–é¡¹æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜çš„mï¼Œä¸é‡æ–°è¿›è¡Œè®¡ç®—

å®šä¹‰ï¼š`const m = useMemo(calculateValue, dependencies)`

å®šä¹‰è¯´æ˜ï¼š

1. å‚æ•°calculateValueï¼šåªèƒ½æ˜¯æ— å‚çš„çº¯å‡½æ•°ï¼Œå¯ä»¥è¿”å›ä»»æ„ç±»å‹ï¼ˆåŒ…æ‹¬jsxèŠ‚ç‚¹ï¼Œreactä¸­ç»„ä»¶è¿”å›çš„å°±æ˜¯jsxï¼‰ï¼Œå°†åœ¨é¦–æ¬¡æ¸²æŸ“æ—¶è°ƒç”¨ï¼Œåé¢ä»…åœ¨dependencieså‘ç”Ÿå˜åŒ–æ—¶è¿›è¡Œè°ƒç”¨ï¼ˆè¿™æ ·èƒ½å¤Ÿè·³è¿‡ä¸€äº›æ˜‚è´µçš„è®¡ç®—ï¼‰
2. å‚æ•°dependenciesï¼šæ‰€æœ‰åœ¨calculateValueå‡½æ•°ä¸­ä½¿ç”¨çš„å“åº”å¼å˜é‡ï¼ˆpropsã€stateã€å˜é‡ã€å‡½æ•°ï¼‰ç»„æˆçš„æ•°ç»„ï¼Œè‹¥ä¸ä¼ ï¼Œåˆ™æ¯æ¬¡éƒ½ä¼šé‡æ–°è®¡ç®—
3. è¿”å›å€¼mï¼šè¿”å›è°ƒç”¨calculateValueçš„ç»“æœï¼Œä¾èµ–æ•°ç»„å‘ç”Ÿå˜åŒ–ï¼Œé‡æ–°è¿”å›è°ƒç”¨calculateValueçš„ç»“æœ

æ³¨æ„ï¼š

- åº”è¯¥ä»…æŠŠuseMemoä½œä¸ºæ€§èƒ½ä¼˜åŒ–çš„æ‰‹æ®µï¼Œè€Œéç¼ºäº†å®ƒå°±ä»£ç ä¸èƒ½å·¥ä½œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œreactä¼šåœ¨ç»„ä»¶æ¯æ¬¡é‡æ¸²æŸ“æ—¶é‡æ–°è¿è¡Œæ•´ä¸ªç»„ä»¶ï¼Œæ­¤æ—¶ç»„ä»¶ä¸­çš„å¯¹è±¡ã€å‡½æ•°éƒ½ä¼šé‡æ–°æ‰§è¡Œï¼Œè¿™åŠ å¤§äº†è¿è¡Œå¼€é”€
- useMemoä¸ä¼šè®©æ¸²æŸ“å˜å¾—æ›´å¿«ï¼Œåªæ˜¯è·³è¿‡äº†è·Ÿä»–ä¾èµ–æ— å…³çš„æ¸²æŸ“ï¼ˆä¸æ‰§è¡Œï¼‰ï¼Œå¯¹äºä¾èµ–ç›¸å…³çš„æ¸²æŸ“ï¼Œè¿˜æ˜¯ä¼šé‡æ–°æ‰§è¡Œçš„
- å¼€å‘ç¯å¢ƒä¸”ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå°†è°ƒç”¨calculateValueä¸¤æ¬¡
- ä½¿ç”¨useMemoçš„æƒ…å†µï¼šuseMemoä¸­çš„è®¡ç®—å¾ˆè€—æ—¶ã€å°†è®¡ç®—ç»“æœä½œä¸ºpropsä¼ é€’ç»™åŒ…è£¹åœ¨memoä¸­çš„ç»„ä»¶æ—¶ã€ä¼ é€’çš„å€¼ç”¨ä½œæŸäº›hookçš„ä¾èµ–é¡¹æ—¶
- è·³è¿‡ç”±äºçˆ¶ç»„ä»¶é‡æ¸²æŸ“å¯¼è‡´ç»„ä»¶æ¸²æŸ“çš„é—®é¢˜ï¼Œå¯ä½¿ç”¨memoå‡½æ•°åŒ…è£¹ç»„ä»¶ï¼Œæ­¤æ—¶memoï¼ˆç¼“å­˜JSXèŠ‚ç‚¹ï¼‰åŒ…è£¹çš„ç»„ä»¶åœ¨çˆ¶ç»„ä»¶é‡æ¸²æŸ“æ—¶ï¼Œä¸ä¼šé‡æ–°æ¸²æŸ“ï¼Œé™¤éä¼ å…¥ç»™ç»„ä»¶çš„propså‘ç”Ÿäº†å˜æ›´

```jsx
import { memo } from 'react'

const List = memo(function List({ items }) {
   const [name, setName] = useState('')

   const itemName = useMemo(() => {
      // æ­¤å¤„ï¼Œä»…å½“nameã€itmeså‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šé‡æ–°è®¡ç®—
      // ...
   }, [name, items])
})

function App(){
   return (
      // ç”±äºè¢«memoåŒ…è£¹ï¼Œå› æ­¤épropsï¼šitems çš„å˜åŒ–ï¼Œå…¶ä»–çˆ¶ç»„ä»¶çš„é‡æ¸²æŸ“ ä¸ä¼šå¯¼è‡´Listç»„ä»¶é‡æ–°æ¸²æŸ“
      <List items={[]} />
   )
}

```

### useCallback

ä½œç”¨ï¼šåœ¨å¤šæ¬¡æ¸²æŸ“ä¸­ç¼“å­˜å‡½æ•°ï¼Œåªåº”ä½œç”¨äºæ€§èƒ½ä¼˜åŒ–ï¼ˆå³åªæœ‰å½±å“äº†æ¸²æŸ“/è¿è¡Œæ•ˆæœçš„æ—¶å€™æ‰ä½¿ç”¨ï¼Œé€šå¸¸å¯ä¸ä½¿ç”¨ï¼‰

å®šä¹‰ï¼š

- `const cachedFn = useCallback(fn, dependencies)`
- ç­‰åŒäº`const cachedFn = useMemo(() => fn, dependencies)`

å®šä¹‰è¯´æ˜ï¼š

1. å‚æ•°fnï¼šæƒ³è¦ç¼“å­˜çš„å‡½æ•°ï¼Œå°†åœ¨åˆæ¬¡æ¸²æŸ“æ—¶ï¼ˆéè°ƒç”¨æ—¶ï¼‰è¿”å›è¯¥å‡½æ•°ï¼Œåç»­ä»…åœ¨ä¾èµ–å˜æ›´æ—¶è¿”å›æœ€æ–°çš„å‡½æ•°
2. å‚æ•°dependenciesï¼šæ˜¯å¦è¦æ›´æ–°fnçš„æ‰€æœ‰å“åº”å¼çš„åˆ—è¡¨ï¼Œå½“çœç•¥æ—¶ï¼Œæ¯æ¬¡éƒ½å°†é‡æ–°è®¡ç®—ï¼Œå½“ä¸ºç©ºæ•°ç»„æ—¶ï¼Œä»…åœ¨åˆæ¬¡æ¸²æŸ“æ—¶ç¼“å­˜fn
3. è¿”å›å€¼cachedFnï¼šåˆæ¬¡æ¸²æŸ“å’Œä¾èµ–å˜æ›´æ—¶ï¼Œè¿”å›ä¼ å…¥çš„fnï¼Œå¦åˆ™è¿”å›ä¸Šä¸€æ¬¡çš„

ä½¿ç”¨åœºæ™¯ï¼š

- ä½œä¸ºpropsä¼ é€’ç»™åŒ…è£¹åœ¨memoä¸­çš„ç»„ä»¶
- ä¼ é€’çš„å‡½æ•°å¯èƒ½ä½œä¸ºæŸäº›hookï¼ˆæ¯”å¦‚useEffectçš„ç¬¬äºŒä¸ªå‚æ•°ï¼‰çš„ä¾èµ–é¡¹ï¼ˆdependenceï¼‰
- è‡ªå®šä¹‰hookä¸­ï¼Œè¿”å›çš„ä»»ä½•å‡½æ•°å»ºè®®éƒ½ä½¿ç”¨useCallbackåŒ…è£¹

useMemo vs. useCallbackï¼š

- ä¸¤è€…åœ¨ä¼˜åŒ–å­ç»„ä»¶æ—¶ï¼Œé€šå¸¸å’Œmemoä¸€åŒå‡ºç°ï¼Œä¸€ä¸ªç¼“å­˜å‡½æ•°è°ƒç”¨çš„ç»“æœï¼Œä¸€ä¸ªç¼“å­˜å‡½æ•°æœ¬èº«
- useMemoè¿”å›å‡½æ•°è°ƒç”¨çš„ç»“æœï¼š`useMemo(() => fn, dep)`
- useCallbackè¿”å›å‡½æ•°æœ¬èº«ï¼š`useCallback(fn, dep)`

æ³¨æ„ï¼šåŒuseMemo

```jsx
function ReportList({ items }) {
   return (
      <article>
         { items.map(item => {
            {/* ä¸èƒ½åœ¨å¾ªç¯ä¸­è°ƒç”¨useCallbackï¼Œä»…èƒ½åœ¨é¡¶å±‚è°ƒç”¨ */}
            const handleClick = useCallback(() => {
               sendReport(item)
            }, [item]);

            return (
               <figure key={item.id}>
                  <Chart onClick={handleClick} />
               </figure>
            );
         })}
      </article>
   )
}

// æ­£ç¡®ç”¨æ³•1ï¼š
function ReportList({ items }) {
   return (
      <article>
         {items.map(item => 
            <Report key={item.id} item={item} />
         )}
      </article>
   )
}
function Report({ item }) {
   // ä½¿ç”¨useCallbackåŒ…è£¹ï¼Œä»…åœ¨itemå˜æ›´æ—¶ï¼Œæ‰ä¼šé‡æ–°æ¸²æŸ“Report
   const handleClick = useCallback(() => {
      sendReport(item)
   }, [item]);

   return (
      <figure>
         <Chart onClick={handleClick} />
      </figure>
   )
}

// æ­£ç¡®ç”¨æ³•2ï¼šä½¿ç”¨memoåŒ…è£¹ï¼Œä»…åœ¨itemå˜æ›´æ—¶ï¼Œæ‰ä¼šé‡æ–°æ¸²æŸ“Report
const Report = memo(function Report({ item }) {
   function handleClick(){
      sendReport(item)
   }

   return (
      <figure>
         <Chart onClick={handleClick} />
      </figure>
   )
}
```

### useContext

ä½œç”¨ï¼šè¯»å–å’Œè®¢é˜…ç»„ä»¶ä¸­çš„context

å®šä¹‰ï¼š

- `const SomeContext = createContext(defalutValue)`
- `const c = useContext(SomeContext)`
- `<SomeContext.Provider value={value}></SomeContext.Provider>`

å®šä¹‰è¯´æ˜ï¼š

1. å‚æ•°defaultValueï¼šè¯¥å€¼ä»ä¸æ”¹å˜ï¼Œæ›´æ–°contextä¸€èˆ¬æ˜¯providerçš„valueå’Œstateä¸€èµ·ä½¿ç”¨
2. å‚æ•°SomeContextï¼šè¯¥å€¼æ˜¯ç”¨createContextåˆ›å»ºçš„context
3. è¿”å›å€¼cï¼šè¿”å›çš„å€¼æ€»æ˜¯æœ€æ–°çš„ï¼ˆæ ¹æ®contextçš„å˜åŒ–è€Œå˜åŒ–ï¼‰ï¼Œè¯¥å€¼æ˜¯æœ€è¿‘ç»„ä»¶æ ‘ä¸Šçš„SomeContext.Providerçš„valueçš„å€¼ï¼Œè‹¥æ— ï¼Œåˆ™å€¼æ˜¯createContextçš„defaultValueçš„å€¼
4. providerçš„valueå±æ€§valueï¼šå¯ä»¥æ˜¯ä»»æ„çš„å€¼ï¼ŒåŒ…æ‹¬å¯¹è±¡å’Œå‡½æ•°ï¼Œå½“çœç•¥æ—¶ï¼Œå€¼ä¸ºundefined

æ³¨æ„ï¼š

- ç»„ä»¶æ˜¯çš„useContextçš„è°ƒç”¨ä»…ä»…å—åŒ…è£¹äº†å¯¹åº”çš„SomeContext.Providerçš„ä¸Šçº§ç»„ä»¶çš„å½±å“ï¼Œè€Œéè°ƒç”¨äº†SomeContextçš„ä¸Šçº§ç»„ä»¶çš„
- ğŸ”´åœ¨provideræ¥æ”¶åˆ°ä¸åŒçš„valueå¼€å§‹ï¼Œä¼šé‡æ¸²æŸ“ä½¿ç”¨äº†è¯¥ç‰¹å®šcontextçš„æ‰€æœ‰å­çº§ï¼Œå¯ä½¿ç”¨memoï¼ˆåŒ…è£¹å­ç»„ä»¶ï¼‰æˆ–ä½¿ç”¨useCallback/useMemoåŒ…è£¹valueä»¥è·³è¿‡é‡æ¸²æŸ“ï¼ˆä½†æ˜¯contextçš„å€¼è¿˜æ˜¯ä¼ è¿‡å»äº†ï¼Œåªæ˜¯ä¸ä¼šå¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼‰
- å½“ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œå¦‚æœproviderçš„valueå±æ€§å€¼æ˜¯å¯¹è±¡å’Œå‡½æ•°ï¼ˆå¼•ç”¨å¯¹è±¡ï¼Œæ¸²æŸ“åå’Œä¹‹å‰ä¸æ˜¯åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼‰ï¼Œåˆ™è¿˜ä¼šé‡æ–°æ¸²æŸ“æ‰€æœ‰è°ƒç”¨å¯¹åº”çš„useContextçš„ç»„ä»¶ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨useCallbackåŒ…è£¹å‡½æ•°ï¼Œä½¿ç”¨useMemoåŒ…è£¹å¯¹è±¡ï¼Œä»¥æ­¤æ¥è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œè‡³æ­¤å½“ç»„ä»¶é‡æ¸²æŸ“æ—¶ï¼Œè°ƒç”¨å¯¹åº”çš„useContextçš„ç»„ä»¶ä¸ä¼šå‘ç”Ÿé‡æ¸²æŸ“ï¼Œé™¤éåŒ…è£¹çš„å¯¹è±¡å’Œå‡½æ•°ä¾èµ–çš„å€¼å‘ç”Ÿå˜åŒ–äº†
- å¯ä»¥å°†providerå°è£…æˆç»„ä»¶ä½¿ç”¨
- å¯ä»¥åµŒå¥—ä½¿ç”¨å¤šä¸ªç›¸åŒæˆ–ä¸åŒçš„providerï¼Œåœ¨åµŒå¥—æ—¶ï¼Œä¸‹å±‚providerçš„valueå€¼è‹¥ä¾èµ–contextï¼Œè¯¥contextæ˜¯åŸºäºä¸Šä¸€å±‚providerçš„valueè®¡ç®—æ¥çš„ã€‚ä¸¾ä¾‹ï¼Œå…±åµŒå¥—äº†ä¸‰å±‚`<SomeContext.Provider></SomeContext.Provider>`ï¼Œå…¶valueå±æ€§å€¼éƒ½æ˜¯`someContext + 1`ï¼Œè‹¥åˆå§‹å€¼æ˜¯1ï¼Œæ­¤æ—¶ï¼Œå„å±‚ä¸‹é¢çš„å­ç»„ä»¶è¯»å–åˆ°çš„useContextçš„å€¼åˆ†åˆ«æ˜¯`2ï¼Œ 3ï¼Œ 4`
- å¯ä»¥å°†å˜é‡å€¼å’Œä¿®æ”¹å˜é‡çš„å‡½æ•°ä¸€åŒä¼ é€’ç»™providerçš„valueå±æ€§ï¼Œè¿™æ ·ï¼Œåœ¨ä½¿ç”¨useContextçš„å­ç»„ä»¶ä¸­ï¼Œå°±å¯ä»¥ç›´æ¥ä¿®æ”¹å˜é‡äº†

::: code-group

```jsx [contextå’Œreducerä¸€èµ·ä½¿ç”¨]
// æŠ½ç¦»providerä¸ºç»„ä»¶ï¼Œå…¶ä»–ä»£ç çœç•¥ï¼Œåªåˆ—å‡ºé‡è¦ä»£ç 
const TasksContext = createContext(null)
const TasksDispatchConext = createContext(null)

function TasksProvider({ children }) {
   const [tasks, dispatch] = useReducer(tasksReducer, initialTasks)

   return (
      <TasksContext.Provider value={tasks}>
         <TasksDispatchConext.Provider value={dispatch}>
            {children}
         </TasksDispatchConext.Provider>
      </TasksContext.Provider>
   )
}

// ä½¿ç”¨ç»„ä»¶
function TaskApp(){
   return (
      <TasksProvider>
         {/* è¯¥ç»„ä»¶å†…éƒ¨å¯ä»¥ä½¿ç”¨dispatchä¿®æ”¹tasks */}
         <AddTask />
         <TasksList />
      </TasksProvider>
   )
}
```

```jsx [å¤šä¸ªcontextåµŒå¥—]
const LevelContext = createContext(0)

function Section({children}) {
   const level = useContext(LevelContext)
   return (
      <section className="section">
         {/* æ¯åµŒå¥—ä¸€å±‚ï¼Œè¯»å–åˆ°çš„levelçš„å€¼éƒ½æ˜¯ä¸Šä¸€å±‚çš„å€¼+1 */}
         <LeveContext.Provider value={level + 1}>
            {children}
         </LeveContext.Provider>
      </section>
   )
}

// ä½¿ç”¨
function Heading({children}) {
   // é€šè¿‡åµŒå¥—å±‚çº§ï¼Œå±•ç¤ºå…·ä½“çš„æ ‡é¢˜çº§åˆ«
   const level = useContext(LevelContext)
   switch(level) {
      case 0:
         throw new Error('Heading must be inside Section')
      case 1:
         return <h1>{children}</h1>
      case 2:
         return <h2>{children}</h2>
         // ......
   }
}

function Page() {
   return (
      <Section>
         <Heading>Title</Heading>
         <Section>
            <Heading>Subtitle</Heading>
         </Section>
      </Section>
   )
}
```

```jsx [contextå’ŒuseMemoä¸€èµ·ä½¿ç”¨]
function MyApp(){
   const [currentUser, setCurrentUser] = useState(null)

   const login = useCallback(response => {
      storeCredentials(response.credentials)
      setCurrentUser(response.user)
   }, [])

   const contextValue = useMemo(() => ({
      currentUser,
      login
   }), [currentUser, login])

   return (
      <AuthContext.Provider value={contextValue}>
         <Page/>
      </AuthContext.Provider>
   )
}
```

:::

### useReducer

ä½œç”¨ï¼šç»™ç»„ä»¶æ·»åŠ ä¸€ä¸ªreducerï¼ˆåŒ…æ‹¬æ‰€æœ‰ç»„ä»¶çŠ¶æ€æ›´æ–°é€»è¾‘çš„å¤–éƒ¨å‡½æ•°ï¼‰

å®šä¹‰ï¼š`const [state, dispatch] = useReducer(reducer, initialArg, init?)`

å®šä¹‰è¯´æ˜ï¼š

1. å‚æ•°reducerï¼šç”¨äºæ›´æ–°å˜é‡stateçš„çº¯å‡½æ•°ï¼Œå‚æ•°ä¸ºå½“å‰çš„stateå’Œactionï¼ˆä»»æ„å€¼ï¼‰ï¼Œè¿”å›æ›´æ–°åçš„state
2. å‚æ•°initialArgï¼šå˜é‡stateçš„åˆå§‹å€¼
3. å‚æ•°initå‡½æ•°ï¼šå¯é€‰ï¼Œç”¨äºè®¡ç®—åˆå§‹å€¼å‡½æ•°ï¼Œå­˜åœ¨åˆ™ä½¿ç”¨init(initialArg)çš„æ‰§è¡Œç»“æœä½œä¸ºåˆå§‹å€¼ï¼Œå¦åˆ™ä½¿ç”¨initialArgä½œä¸ºåˆå§‹å€¼
4. è¿”å›å€¼state
5. è¿”å›å€¼dispatchå‡½æ•°ï¼šæ¥å—actionä½œä¸ºå‚æ•°ï¼Œè°ƒç”¨å®ƒæ—¶ï¼Œreactä¼šè°ƒç”¨reducerå‡½æ•°ç”¨äºæ›´æ–°stateï¼›ç”¨äºæ›´æ–°stateï¼Œå¹¶è§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“
6. actionï¼šé€šå¸¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆä¾‹å¦‚`{type: 'add', payload: data}`ï¼‰ï¼Œreducerä¼šå°†actionçš„å†…å®¹ï¼ˆä¾‹å¦‚`type`ï¼‰ä½œä¸ºæ¡ä»¶ï¼Œæ ¹æ®ä¸åŒæ¡ä»¶ï¼ˆé€šè¿‡ifæˆ–switchï¼‰è¿”å›ä¸åŒæ“ä½œçš„state

æ³¨æ„ï¼š

- ç¬¬äºŒä¸ªå‚æ•°è‹¥æ˜¯ä¸€ä¸ªå‡½æ•°çš„è°ƒç”¨ï¼Œåˆ™åœ¨æ¯æ¬¡é‡æ¸²æŸ“æ—¶éƒ½ä¼šè¢«æ‰§è¡Œï¼ˆå½±å“æ€§èƒ½ï¼‰ï¼Œæ­£ç¡®åšæ³•æ˜¯å°†è¯¥å‡½æ•°ä¼ é€’ç»™ç¬¬ä¸‰ä¸ªå‚æ•°ä½œä¸ºåˆå§‹åŒ–å‡½æ•°
- dispatchå‡½æ•°æ˜¯ä¸ºä¸‹ä¸€æ¬¡æ¸²æŸ“è€Œæ›´æ–°stateï¼Œè°ƒç”¨å®ƒä¹‹åçš„ä»£ç çš„stateè¿˜æ˜¯åŸæ¥çš„å€¼ï¼Œå¦‚æœæƒ³ç«‹é©¬è·å–æ›´æ–°åçš„stateï¼Œåˆ™åé¢å¯ä»¥æ‰‹åŠ¨è°ƒç”¨`reducer`å‡½æ•°è·å–æœ€æ–°çš„ç»“æœ
- å½“stateå’Œä¸Šä¸€ä¸ªstateç›¸åŒæ—¶ï¼Œä¼šè·³è¿‡ç»„ä»¶çš„é‡æ¸²æŸ“
- reducerå‡½æ•°ä¸­ä¸è¦ä¿®æ”¹stateï¼ˆå¼•ç”¨åœ°å€ä¸å˜ï¼‰ï¼Œè€Œæ˜¯æ›¿æ¢stateï¼ˆå¼•ç”¨åœ°å€ä¼šå˜ï¼‰è¿”å›æ–°çš„å¯¹è±¡
- reactæ‰§è¡Œçš„æ˜¯æ‰¹é‡æ›´æ–°stateçš„ç­–ç•¥ï¼Œä¼šåœ¨æ‰€æœ‰äº‹ä»¶å‡½æ•°æ‰§è¡Œå®Œæ¯•å¹¶ä¸”å·²ç»è°ƒç”¨ä»–çš„setå‡½æ•°åè¿›è¡Œæ›´æ–°ï¼Œé˜²æ­¢åœ¨ä¸€ä¸ªäº‹ä»¶ä¸­å¤šæ¬¡è¿›è¡Œé‡æ¸²æŸ“ï¼Œè‹¥æƒ³æå‰æ›´æ–°å¯ä»¥ä½¿ç”¨flushSync
- useReducerå’ŒuseStateéå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯useReducerå¯ä»¥å°†çŠ¶æ€æ›´æ–°é€»è¾‘ç§»åˆ°ç»„ä»¶å¤–éƒ¨
- reducerå‡½æ•°å†…éƒ¨ï¼Œä¹ æƒ¯ç”¨switchè¯­å¥ï¼Œä¸”æ¯ä¸ªcaseè¯­å¥å—ä½¿ç”¨`{}`åŒ…è£¹ï¼Œè¿™æ ·ä¸ä¼šå¼•èµ·å˜é‡å†²çª
- ä¸€ä¸ªå¥½çš„reducerï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ã€ä¸”æ¯ä¸ªactionéƒ½ä»…æè¿°äº†ä¸€ä¸ªå•ä¸€çš„ç”¨æˆ·äº¤äº’ï¼Œå³ä»…æ ¹æ®å½“å‰çš„stateå’Œactionæ”¹å˜å½“å‰çš„stateï¼Œè€Œä¸åº”è¯¥å‚æ‚å…¶ä»–çš„æ“ä½œï¼Œæ¯”å¦‚æ”¹å˜å…¶ä»–å˜é‡çš„å€¼
- å¯ä»¥ä½¿ç”¨immerç­‰ç¬¬ä¸‰æ–¹åº“å‡å°‘é‡å¤çš„æ ·æ¿ä»£ç ï¼Œæ›´ä¸“æ³¨äºé€»è¾‘
- `useReducer(reducer, name, createInitialFn)`ç›¸æ¯”äº`useReducer(reducer, createInitialFn(name))`ï¼Œå‰è€…ä»…ä¼šåœ¨åˆå§‹æ¸²æŸ“æ—¶æ‰§è¡Œï¼Œè€Œåè€…ï¼ˆåªä¼ åˆå§‹å€¼ï¼‰æ¯æ¬¡é‡æ¸²æŸ“éƒ½ä¼šæ‰§è¡Œï¼Œå¯èƒ½æ›´è€—è´¹æ€§èƒ½

::: code-group

```jsx [åŸºæœ¬ç”¨æ³•]
const initialTasks = [
   { id: 1, title: 'Learn React', done: true },
   { id: 2, title: 'Learn Redux', done: false },
   { id: 3, title: 'Learn React Hooks', done: false },
]
function tasksReducer(tasks, action) {
   // æ ¹æ®typeè¿›è¡Œä¸åŒçš„æ“ä½œ
   swith(action.type) {
      case 'add':
         return [...tasks, { id: action.id, title: action.title, done: false }]
      case 'changed':
         return tasks.map(task => {
            if (task.id === action.task.id) {
               return action.task
            } else {
               return task
            }
         })
      case 'deleted':
         return tasks.filter(task => task.id !== action.id)
      default:
         trow new Error('Unknown action type')
   }
}

function TaskApp() {
   const [tasks, dispatch] = useReducer(tasksReducer, initialTasks)

   funciton addTask(text) {
      dispatch({
         type: 'add',
         id: Date.now(),
         text: text
      })
   }

   funciton changeTask(task) {
      dispatch({
         type: 'changed',
         task: task
      })
   }

   fucntion deleteTask(id) {
      dispatch({
         type: 'deleted',
         id: id
      })
   }

   return (
      <>
         <AddTask add={addTask}/>
         <TaskList tasks={tasks} onChange={changeTask} onDelete={deleteTask}/>
      </>
   )
}
```

:::

### useRef

ä½œç”¨ï¼šå¯ä»¥å¼•ç”¨ä¸€ä¸ªä¸éœ€è¦æ¸²æŸ“çš„å€¼

å®šä¹‰ï¼š`const ref = useRef(initialValue)`

å®šä¹‰è¯´æ˜ï¼š

1. å‚æ•°initialValueï¼šrefå¯¹è±¡çš„currentå±æ€§çš„åˆå§‹å€¼ï¼Œå¯ä»¥æ˜¯ä»»æ„å€¼ï¼Œé¦–æ¬¡æ¸²æŸ“åè¢«å¿½ç•¥
2. è¿”å›å€¼refï¼šè¯¥å€¼ä»…åŒ…å«ä¸€ä¸ªå±æ€§currentï¼Œåˆå§‹æ¸²æŸ“æ—¶å€¼ä¸ºinitialValueï¼Œåç»­æ¸²æŸ“æ—¶éƒ½è¿”å›åŒä¸€ä¸ªå¯¹è±¡ï¼Œå¯å°†refä½œä¸ºjsxèŠ‚ç‚¹refå±æ€§çš„å€¼

ä½¿ç”¨refçš„ä¼˜åŠ¿ï¼š

- å­˜å‚¨ä¿¡æ¯è€Œä¸è¢«é‡ç½®ï¼ˆæ™®é€šå¯¹è±¡åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šé‡ç½®ï¼‰
- ä¿®æ”¹å€¼ä¸ä¼šè§¦å‘é‡æ¸²æŸ“ï¼ˆçŠ¶æ€å˜é‡ä¼šè§¦å‘é‡æ¸²æŸ“ï¼‰ï¼Œæ‰€ä»¥è‹¥è¯¥å€¼æƒ³æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œåˆ™å¿…é¡»åŒ…å«å¯¼è‡´é‡æ¸²æŸ“çš„æ“ä½œï¼Œå¦åˆ™åœ¨å±å¹•ä¸Šä¸ä¼šæ›´æ–°è¯¥å€¼ï¼Œæˆ–è€…ç”¨stateä»£æ›¿è¯¥å€¼
- å­˜å‚¨çš„ä¿¡æ¯ä»…ä½œç”¨äºä½¿ç”¨çš„ç»„ä»¶å†…éƒ¨

ä½¿ç”¨åœºæ™¯ï¼š

- å­˜å‚¨timeout ID
- å­˜å‚¨å’Œæ“ä½œDOMå…ƒç´ 
- å­˜å‚¨ä¸éœ€è¦è¢«ç”¨æ¥è®¡ç®—JSXçš„å…¶ä»–å¯¹è±¡

æ³¨æ„ï¼š

- æ”¹å˜ref.currentæ—¶ï¼Œä¸ä¼šè§¦å‘é‡æ¸²æŸ“ï¼Œè¯¥å€¼åªæ˜¯ä¸€ä¸ªæ™®é€šjså¯¹è±¡
- ç”¨é€”æœ‰ï¼šåœ¨å¤šæ¬¡æ¸²æŸ“æ—¶å­˜å‚¨ä¿¡æ¯è€Œä¸è¢«é‡ç½®ã€æ“ä½œdom
- å°†refå¯¹è±¡ä½œä¸ºjsx domèŠ‚ç‚¹çš„refå±æ€§ï¼Œåœ¨åˆ›å»ºdomèŠ‚ç‚¹å¹¶æ¸²æŸ“åˆ°å±å¹•æ—¶ï¼Œä¼šæŠŠèŠ‚ç‚¹è®¾ç½®ä¸ºrefå¯¹è±¡çš„currentå±æ€§ï¼Œç„¶åå¯ä»¥è°ƒç”¨ç›¸å…³çš„æ–¹æ³•
- è‹¥å°†refç”¨åœ¨è‡ªå®šä¹‰ç»„ä»¶ä¸Šï¼Œéœ€è¦å°†è¯¥è‡ªå®šä¹‰ç»„ä»¶ç”¨forwardRefåŒ…è£¹èµ·æ¥ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œè‡ªå®šä¹‰ç»„ä»¶ä¸ä¼šæš´éœ²å†…éƒ¨domèŠ‚ç‚¹çš„ref
- ä¸è¦åœ¨æ¸²æŸ“æœŸé—´è¯»å†™ï¼ˆä¾‹å¦‚`<h1>{ref.current}</h1>`, `ref.current = xxx`ï¼‰refï¼ˆå³returnçš„jsxã€ç»„ä»¶å‡½æ•°ä»£ç å—ï¼‰ï¼Œå› ä¸ºç»„ä»¶ä¸»ä½“åº”è¯¥è¡¨ç°çš„åƒçº¯å‡½æ•°ï¼Œè€Œå†™å…¥ã€è¯»å–refä¼šç ´åè¿™äº›è¡Œä¸ºã€‚ç›¸åº”çš„å¯ä»¥åœ¨äº‹ä»¶å¤„ç†ç¨‹åºæˆ–useEffectä¸­è¯»å†™ã€‚å¦åˆ™å°±ç”¨stateä»£æ›¿

::: code-group

```jsx [åŸºæœ¬ç”¨æ³•]
function Video (){ 
   // é¿å…åˆ›å»ºé‡å¤çš„refï¼Œåç»­å‘ç”Ÿé‡æ¸²æŸ“æ—¶ï¼Œè¯¥refä¸ä¼šè¢«é‡ç½®
   const playerRef = useRef(null)
   // ç»Ÿè®¡æ¡ä»¶åˆ¤æ–­æ˜¯å¦æ¸²æŸ“ï¼Œé¿å…æœ‰å¯èƒ½çš„é‡æ¸²æŸ“å¯¼è‡´æ€§èƒ½æµªè´¹
   // åœ¨æ¡ä»¶æ¨¡å¼ä¸‹ï¼Œæ˜¯å¯ä»¥è¿›è¡Œrefçš„è¯»å†™çš„ï¼ˆå› ä¸ºè¿™ç§æƒ…å†µå¯é¢„æµ‹ï¼‰ï¼Œéæ¡ä»¶æ¨¡å¼ä¸‹åˆ«è¿™æ ·åš
   if (playerRef.current === null) {
      playerRef.current = new VideoPlayer()
   }

   // åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼ŒæŠ½ç¦»å‡½æ•°ï¼Œæ£€æµ‹null
   function getPlayer (){
      if (playerRef.current !== null) {
         return playerRef.current
      }
      const player = new VideoPlayer()
      palyerRef.current = player
      return player
   }
}
```

```jsx [å‘ç»„ä»¶æš´éœ²ref]
// é€šè¿‡forwardRefåŒ…è£¹ç»„ä»¶ï¼Œä»¥æš´éœ²å†…éƒ¨domèŠ‚ç‚¹çš„ref
// 1. refå‚æ•°ä¸å¯çœç•¥ï¼Œç”¨äºå°†å¤–éƒ¨ä¼ å…¥çš„refå˜é‡ä½œç”¨äºç»„ä»¶/å…ƒç´ ä¸­ï¼Œä»¥è®©å¤–éƒ¨èƒ½å¤Ÿè®¿é—®è¯¥ç»„ä»¶å†…çš„domèŠ‚ç‚¹/ç»„ä»¶
const MyInput = fowardRef((props, ref) => {
   // 2. ä¼ å…¥çš„refå¿…é¡»è®¾ç½®åˆ°å¯¹åº”çš„å…ƒç´ /ç»„ä»¶ä¸Šï¼Œå¦åˆ™è¯»åˆ°çš„refå€¼ä¸ºnull
   return <input ref={ref}  {...props} />
})

function Form(){
   const inputRef = useRef(null)
   function  handleClick (){
      inputRef.current.focus()
   }

   return (
      <>
         {/* 3. ä¼ å…¥ref */}
         <MyInput ref={inputRef} />
         <button onClick={handleClick}>Focus the input</button>
      </>
   )
}
```

```jsx [ç®¡ç†å¤šä¸ªref]
// å°†å‡½æ•°ä¼ é€’ç»™refå±æ€§ï¼ˆrefå›è°ƒï¼‰
function CatFriends(){
   const itemsRef = useRef(null)

   function getMap(){
      if(!itemsRef.current) {
         itemsRef.current = new Map()
      }
      return itemsRef.current
   }

   function getCurrentNode (id){
      const map = getMap()
      console.log(map.get(id))
   }

   return (
      <>
         <ul>
            {catList.map(cat => (
               <li key={cat.id}
                  ref={node => {
                     const map = getMap()
                     if (node) {
                        map.set(cat.id, node)
                     } else {
                        map.delete(cat.id)
                     }
                  }}
                  onClick={() => getCurrentNode(cat.id)}
               >
                  {cat.name}
               </li>

            ))}
         </ul>
      </>
   )
}
```

:::

### useId

ä½œç”¨ï¼šç”Ÿæˆä¸€ä¸ªå”¯ä¸€ID

å®šä¹‰ï¼š`useId()`

å®šä¹‰è¯´æ˜ï¼š

1. è¿”å›ä¸€ä¸ªå”¯ä¸€çš„å­—ç¬¦ä¸² ID

æ³¨æ„ï¼š

- åªèƒ½åœ¨ç»„ä»¶é¡¶å±‚/hook ä¸­è°ƒç”¨ï¼Œä¸èƒ½ç”¨åœ¨å¾ªç¯æˆ–æ¡ä»¶åˆ¤æ–­ä¸­
- useIdä¸åº”è¯¥ç”¨åœ¨åˆ—è¡¨çš„keyä¸­ï¼Œåˆ—è¡¨keyåº”ç”±æ•°æ®ç”Ÿæˆ
- ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“æ—¶ï¼ŒuseIdéœ€è¦åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¸Šæœ‰ç›¸åŒçš„ç»„ä»¶æ ‘ï¼Œè‹¥åœ¨ä¸¤è€…ä¹‹é—´æ¸²æŸ“çš„æ ‘ä¸å®Œå…¨åŒ¹é…ï¼Œåˆ™ç”Ÿæˆçš„idä¹Ÿæ˜¯ä¸åŒ¹é…çš„

ç”¨æ³•ï¼š

- è¯¥hookèƒ½å¤Ÿä¿è¯ç”Ÿæˆçš„idæ˜¯æ•´ä¸ªåº”ç”¨å…¨å±€å”¯ä¸€çš„ï¼Œé¿å…äº†idä¹‹é—´çš„å†²çª
- èƒ½å¤Ÿå’ŒæœåŠ¡ç«¯æ¸²æŸ“ä¸€èµ·å·¥ä½œï¼Œä¸”ç”Ÿæˆå†…å®¹çš„é¡ºåºå’Œé¢„æœŸæ˜¯ä¸€è‡´çš„ï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šé€’å¢è®¡æ•°å™¨ï¼ˆ+1ï¼‰åœ¨æ¸²æŸ“ä¹‹åè¾“å‡ºçš„é¡ºåºå¯èƒ½ä¸ä¸€è‡´ï¼ˆåœ¨æœåŠ¡å™¨æ¸²æŸ“æœŸé—´ï¼Œç»„ä»¶ä¼šç”Ÿæˆå¹¶è¾“å‡ºæˆhtmlï¼Œç„¶ååœ¨å®¢æˆ·ç«¯ä¸Šï¼Œ`hydration`ä¼šå°†äº‹ä»¶å¤„ç†ç¨‹åºé™„åŠ åˆ°htmlä¸Šã€‚ï¼‰ï¼ŒuseIdèƒ½å¤Ÿç¡®ä¿hydrationæ­£å¸¸å·¥ä½œï¼Œä¸”æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„è¾“å‡ºæ˜¯åŒ¹é…çš„
- è‹¥ä¸€ç»„ç›¸å…³çš„å…ƒç´ éœ€è¦ç”Ÿæˆidï¼Œå¯ä½¿ç”¨useIdç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²å‰ç¼€ï¼Œç„¶åå†åœ¨å¯¹äºçš„å…ƒç´ ä¸ŠåŠ ä¸Šç‹¬ç‰¹çš„åç¼€æ ‡è¯†å³å¯
- è‹¥å•ä¸ªé¡µé¢ä¸Šæ¸²æŸ“äº†å¤šä¸ªç‹¬ç«‹çš„reactç¨‹åºï¼Œéœ€è¦å…ˆåœ¨`createRoot`æˆ–`hydrateRoot`è°ƒç”¨ä¸­å°†identifierPrefixä½œä¸ºé€‰é¡¹ä¼ é€’ï¼ˆç”¨äºæŒ‡å®šå‰ç¼€ï¼‰ï¼Œç„¶åæ­£å¸¸è°ƒç”¨useIdï¼Œè¿™æ ·èƒ½å¤Ÿç¡®ä¿å„ä¸ªåº”ç”¨ä¹‹é—´ä½¿ç”¨useIdç”Ÿæˆçš„idä¸å†²çª

## ç»„ä»¶

### Fragment

ä½œç”¨ï¼šåœ¨ä¸æ·»åŠ é¢å¤–èŠ‚ç‚¹çš„æƒ…å†µä¸‹å°†å­å…ƒç´ ç»„åˆ

å®šä¹‰ï¼š`<Fragment></Fragment>`ã€`<></>`

æ³¨æ„ï¼š

- è‹¥æƒ³ç»™ç»„ä»¶ä¼ é€’keyï¼Œåˆ™ä¸èƒ½ä½¿ç”¨ç®€å†™

### StrictMode

ä½œç”¨ï¼šåœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯ç”¨ç»„ä»¶æ ‘å†…éƒ¨é¢å¤–çš„å¼€å‘è¡Œä¸ºå’Œè­¦å‘Š

å®šä¹‰ï¼š`<StrictMode></StrictMode>`

å®šä¹‰è¯´æ˜ï¼šæ— å‚

æ³¨æ„ï¼š

- ä¸¥æ ¼æ¨¡å¼ä¸‹å¯ç”¨çš„è¡Œä¸ºï¼šç»„ä»¶å°†é‡æ¸²æŸ“ä¸€æ¬¡ï¼ˆæ£€æŸ¥éçº¯æ¸²æŸ“é”™è¯¯ï¼ŒåŒ…æ‹¬ç»„ä»¶å‡½æ•°ä½“é¡¶å±‚é€»è¾‘ï¼Œä¼ é€’ç»™useStateã€useMemoã€useReducerã€setçš„å‚æ•°ï¼Œconstructorã€renderã€shouldComponentUpdateç­‰éƒ¨åˆ†ç±»ç»„ä»¶æ–¹æ³•ï¼‰ã€å°†é‡è¿è¡ŒEffectä¸€æ¬¡ï¼ˆæ£€æŸ¥æ˜¯å¦ç¼ºå°‘effectæ¸…ç†ï¼Œæ£€æŸ¥æ˜¯å¦ç¬¦åˆé¢„æœŸï¼‰ã€æ£€æŸ¥æ˜¯å¦ä½¿ç”¨åºŸå¼ƒçš„API
- åœ¨è¯¥ç»„ä»¶åŒ…è£¹çš„æ ‘ä¸­ï¼Œæ— æ³•é€€å‡ºä¸¥æ ¼æ¨¡å¼
- å¯åŒ…è£¹ä»»æ„ç»„ä»¶
- ä»…åœ¨å¼€å‘ç¯å¢ƒè¿è¡Œ

### Profiler

ä½œç”¨ï¼šæµ‹é‡ç»„ä»¶æ ‘çš„æ¸²æŸ“æ€§èƒ½

å®šä¹‰ï¼š`<Profiler id="CompName" onRender={onRenderFn}><CompName></CompName></Profiler>`

å®šä¹‰è¯´æ˜ï¼š

1. ä½¿ç”¨è¯¥ç»„ä»¶åŒ…è£¹éœ€è¦è¿›è¡Œæ€§èƒ½æµ‹é‡çš„ç»„ä»¶æ ‘ï¼Œidä¸ºç»„ä»¶åè¯
2. å¯åµŒå¥—ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ç›‘æµ‹å“ªé‡Œå°±åŒ…è£¹å“ªé‡Œ
3. onRenderï¼šæ€§èƒ½æµ‹é‡çš„å›è°ƒå‡½æ•°ï¼Œèƒ½å¤Ÿè·å–æ¸²æŸ“å†…å®¹å’Œæ‰€èŠ±è´¹çš„æ—¶é—´
4. é»˜è®¤åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹è¢«ç¦ç”¨ï¼Œ[åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹å¯ç”¨](https://fb.me/react-profiling)

### Suspense

ä½œç”¨ï¼šåœ¨å­ç»„ä»¶å®ŒæˆåŠ è½½å‰å±•ç¤ºåå¤‡å†…å®¹

å®šä¹‰ï¼š`<Suspense fallback={<Loading/>}><SomeComponent/></Suspense>`

æ³¨æ„ï¼š

- åªæœ‰å¯ç”¨äº†Suspenseçš„æ•°æ®æºæ‰ä¼šæ¿€æ´»Suspenseç»„ä»¶ï¼ŒåŒ…æ‹¬ï¼šæ”¯æŒå®ƒçš„æ¡†æ¶å¦‚Relay/Nextjsã€ä½¿ç”¨lazyæ‡’åŠ è½½ç»„ä»¶ä»£ç ã€ä½¿ç”¨useè¯»å–Promiseçš„å€¼
- Suspenseæ— æ³•æ£€æµ‹åœ¨Effectå’Œäº‹ä»¶å¤„ç†ç¨‹åºä¸­è·å–æ•°æ®çš„æƒ…å†µ
- Suspenseå†…éƒ¨æ•´ä¸ªç»„ä»¶æ ‘éƒ½è¢«è§†ä¸ºä¸€ä¸ªå•å…ƒï¼Œå³ä½¿æ•´ä¸ªç»„ä»¶æ ‘åªæœ‰å…¶ä¸­ä¸€ä¸ªç»„ä»¶è¢«æŒ‚èµ·ï¼Œä¹Ÿéƒ½å°†è¢«æ›¿æ¢ä¸ºfallback
- å¯ä»¥åµŒå¥—ä½¿ç”¨Suspenseï¼Œåˆ†åˆ«ä¸ºéœ€è¦çš„ç»„ä»¶è®¾ç½®åå¤‡ç»„ä»¶ï¼Œè¿™æ ·å°±ä¸ç”¨æ•´ä¸ªç»„ä»¶æ ‘éƒ½è¢«æ›¿æ¢äº†

## API

### createContext

**createContext**: åˆ›å»ºä¸€ä¸ªç»„ä»¶èƒ½å¤Ÿæä¾›/è¯»å–çš„context

**SomeContext.Provider**: ç”¨context provideråŒ…è£¹ç»„ä»¶ï¼Œç”¨valueä¸ºæ•´ä¸ªç»„ä»¶æ ‘ï¼ˆå±‚çº§ä¸é™ï¼‰æŒ‡å®šä¸€ä¸ªcontextçš„å€¼

ç”¨æ³•ï¼š

1. å°†æ‰€æœ‰çš„contextå•ç‹¬åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¯¼å‡ºï¼Œå› ä¸ºä¸æ­¢ä¸€ä¸ªç»„ä»¶éœ€è¦è¯»å–åŒä¸€ä¸ªä¸Šä¸‹æ–‡

### forwardRef

ä½œç”¨ï¼šåœ¨ç»„ä»¶ä¸Šä½¿ç”¨refæ—¶ï¼Œå…è®¸å°†domèŠ‚ç‚¹æš´éœ²ç»™çˆ¶ç»„ä»¶

å®šä¹‰ï¼š`const SomeComponent = forwardRef(render)`

å®šä¹‰è¯´æ˜ï¼š

1. å‚æ•°renderï¼šç»„ä»¶çš„æ¸²æŸ“å‡½æ•°ï¼ˆæ¥æ”¶propsã€refå±æ€§ï¼‰ï¼Œå½“ä¸ºå‡½æ•°ç»„ä»¶æ—¶ï¼Œå°±æ˜¯ç»„ä»¶æœ¬èº«
2. è¿”å›å€¼SomeComponentï¼šè¿”å›èƒ½å¤Ÿæ¥æ”¶propsã€refå±æ€§çš„ç»„ä»¶

:::code-group

```javascript [æš´éœ²æ•´ä¸ªèŠ‚ç‚¹]
function Form () {
   // æ­¥éª¤3ï¼šå®šä¹‰ref
   const ref = useRef(null)

   function handleClick () {
      // æ­¥éª¤5ï¼šè¿™é‡Œæ‹¿åˆ°çš„å°±æ˜¯inputèŠ‚ç‚¹
      ref.current.focus()
   }

   return (
      <form>
         {/* æ­¥éª¤4ï¼šåœ¨ç»„ä»¶ä¸Šä½¿ç”¨ref */}
         <MyInput label='Enter you name:' ref={ref}/>
         <button type="button" onClick={handleClick}>ç¼–è¾‘</button>
      </form>
   )
}

// æ­¥éª¤1ï¼šåœ¨éœ€è¦ä½¿ç”¨refçš„ç»„ä»¶ä¸Šç”¨forwardRefåŒ…è£¹
const MyInput = forwardRef(function MyInput(props, ref) {
   const { label, ...otherProps} = props
   return (
      <label>
         {label}
         {/* æ­¥éª¤2ï¼šå°†refä¼ é€’ç»™æƒ³æš´éœ²çš„èŠ‚ç‚¹ä¸Š */}
         <input {...otherProps} ref={ref}/>
      </label>
   )
})
```

```javascript [æš´éœ²èŠ‚ç‚¹çš„æœ‰é™åŠŸèƒ½]
// æ ¸å¿ƒæ˜¯ä¿®æ”¹MyInput
import { forwardRef, useRef, useImperativeHandle } from 'react'

const MyInput = forwardRef(function MyInput(props, ref)  {
   // æ”¹åŠ¨1ï¼šå®šä¹‰ä¸€ä¸ªrefï¼Œä½œç”¨åœ¨è¦æš´éœ²ç»™çˆ¶ç»„ä»¶çš„èŠ‚ç‚¹ä¸Š
   const inputRef = useRef(null)

   // æ”¹åŠ¨2ï¼šä½¿ç”¨useImperativeHandleæŒ‡å®šè¦æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å¯¹è±¡ï¼ˆref.currentè¯»å–åˆ°çš„ï¼‰
   useImperativeHandle(ref, () => {
      return {
         // è¿™é‡Œä»…æš´éœ²ä¸¤ä¸ªæ–¹æ³•
         focus () {
            inputRef.current.focus()
         },
         scrollIntoView() {
            inputRef.current.scrollIntoView()
         }
      }
   }, [])

   return <input {...props} ref={inputRef}/>
})
```

:::

æ³¨æ„ï¼š

- refå¯åµŒå¥—ä¼ é€’ï¼Œå³æ²¿ç€ç»„ä»¶æ ‘å°†refä¼ é€’ç»™ç›®æ ‡èŠ‚ç‚¹ä¸Šï¼Œæ­¤æ—¶ä¼ é€’é“¾ä¸Šçš„ç»„ä»¶éƒ½éœ€è¦ç”¨forwardRefåŒ…è£¹
- ä¸è¦æ»¥ç”¨refï¼Œèƒ½ç”¨propså°±ä¸åº”è¯¥ç”¨ref

### lazy

ä½œç”¨ï¼šåœ¨ç»„ä»¶åˆæ¬¡æ¸²æŸ“å‰å»¶è¿ŸåŠ è½½ç»„ä»¶ä»£ç ï¼Œé€šå¸¸å’ŒSuspenseä¸€èµ·ä½¿ç”¨å®ç°æ‡’åŠ è½½

å®šä¹‰ï¼š`const SomeComponent = lazy(load)`

å®šä¹‰è¯´æ˜ï¼š

1. å‚æ•°loadå‡½æ•°ï¼šæ— å‚ï¼Œè¿”å›ä¸€ä¸ªPromiseæˆ–thenableçš„å‡½æ•°

```javascript
const MarkdownPreview = lazy(() => delayForDemo(import('./MarkdownPreview.js')))

function MarkdownEditor () {
   return (
      <Suspense fallback={<Loading/>}>
         <MarkdownPreview markdown='markdown'/>
      </Suspense>
   )
}

// æ·»åŠ ä¸€ä¸ªå›ºå®šçš„å»¶è¿Ÿæ—¶é—´ï¼Œä»¥ä¾¿ä½ å¯ä»¥çœ‹åˆ°åŠ è½½çŠ¶æ€
function delayForDemo (promise) {
   return new Promise(res => {
      setTimeout(res, 2000)
   }).then(() => promise)
}
```

æ³¨æ„ï¼š

- åªèƒ½åœ¨ç»„ä»¶å¤–éƒ¨ï¼ˆæ¨¡å—çš„é¡¶å±‚ä½œç”¨åŸŸï¼‰ä½¿ç”¨lazyå‡½æ•°ã€‚ä¸èƒ½åœ¨ç»„ä»¶å†…éƒ¨ä½¿ç”¨lazyå‡½æ•°ï¼Œå¦åˆ™å°†å¯¼è‡´åœ¨é‡æ¸²æŸ“æ—¶é‡ç½®æ‰€æœ‰çŠ¶æ€

### memo

ä½œç”¨ï¼šå½“çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œé€šå¸¸å­ç»„ä»¶ä¹Ÿä¼šé‡æ¸²æŸ“ï¼Œmemoçš„ä½œç”¨å°±æ˜¯åœ¨ä¼ å…¥çš„propsæœªæ”¹å˜æ—¶è·³è¿‡å­ç»„ä»¶çš„é‡æ¸²æŸ“ï¼ˆé€šå¸¸æ˜¯è¿™æ ·çš„ï¼ŒæŸäº›æ—¶å€™å³ä½¿ç”¨äº†memoä¹Ÿä¼šè¿›è¡Œé‡æ¸²æŸ“ï¼‰

å®šä¹‰ï¼š`const MemoizedComponent = memo(SomeComponent, arePropsEqual?)`

å®šä¹‰è¯´æ˜ï¼š

1. å‚æ•°SomeComponentï¼šè¦è¿›è¡Œè®°å¿†åŒ–çš„ç»„ä»¶
2. å¯é€‰å‚æ•°arePropsEqualå‡½æ•°ï¼šè¯¥å‡½æ•°æ¥æ”¶2ä¸ªå‚æ•°ï¼Œç»„ä»¶çš„ä¸Šä¸€ä¸ªpropså’Œæ–°çš„propsï¼Œè‹¥ä¸¤è€…ç›¸åŒåº”è¿”å›trueã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸ç”¨æŒ‡å®šè¯¥å‡½æ•°ï¼ˆé»˜è®¤ç”¨Object.isï¼‰ï¼Œæç«¯æƒ…å†µä¸‹ï¼Œå¯ä»¥è‡ªå®šä¹‰é‡æ¸²æŸ“çš„è§„åˆ™
3. è¿”å›å€¼ï¼šè¿”å›ä¸€ä¸ªæ–°çš„è®°å¿†åŒ–ç»„ä»¶ï¼ˆå‡½æ•°ç»„ä»¶ã€forwardRefç»„ä»¶ï¼‰ï¼ŒåŠŸèƒ½å’ŒSomeComponentç›¸åŒ

æ³¨æ„ï¼š

- å¦‚æœä¼ é€’ç»™ç»„ä»¶çš„propsä¸€ç›´ä¸åŒï¼ˆæ¯”å¦‚æ™®é€šå¯¹è±¡å’Œå‡½æ•°ï¼‰ï¼Œåˆ™memoæ˜¯æ— æ•ˆçš„ï¼Œæ‰€ä»¥é€šè¿‡å’ŒuseMemoã€useCallbackä¸€èµ·ä½¿ç”¨
- ğŸ”´åªæœ‰ä¼ å…¥çš„propsä¸æ”¹å˜æ—¶ä¸è§¦å‘é‡æ¸²æŸ“ï¼Œå½“ç»„ä»¶è‡ªèº«çš„çŠ¶æ€ï¼ˆstateã€ä½¿ç”¨çš„contextï¼‰æ”¹å˜æ—¶ï¼Œä¼šè§¦å‘é‡æ¸²æŸ“
- åªåº”è¯¥å°†å…¶ä½œä¸ºæ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆï¼Œè‹¥ç¦»å¼€ä»–æ— æ³•è¿è¡Œï¼Œåˆ™åº”è¯¥ä¿®å¤æ½œåœ¨é—®é¢˜
- å¦‚æœpropsæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸ºäº†é¿å…çˆ¶ç»„ä»¶æ¯æ¬¡éƒ½é‡æ–°åˆ›å»ºè¯¥å¯¹è±¡å¯¼è‡´memoæ•ˆæœæ‰“æŠ˜ï¼Œå¯ä»¥å°†è¯¥å¯¹è±¡ç”¨useMemoåŒ…è£¹ï¼Œæˆ–è€…æ‹†åˆ†å°†è¯¥å¯¹è±¡æ‹†åˆ†æˆå¤šä¸ªå•ç‹¬çš„props
- å¦‚æœpropsæ˜¯ä¸€ä¸ªå‡½æ•°ï¼ˆå¼•ç”¨åœ°å€ï¼‰ï¼Œä¸ºäº†é¿å…æ¯æ¬¡éƒ½æ˜¯ä¸åŒçš„å¼•ç”¨ï¼Œå¯ä»¥å°†è¯¥å‡½æ•°æ”¾åœ¨ç»„ä»¶å¤–éƒ¨ï¼Œæˆ–è€…ç”¨useCallbackåŒ…è£¹

## å’Œvueå¯¹æ¯”çš„å†™æ³•

### å…·åæ’æ§½

å°†ç»„ä»¶å½“ä½œpropsä¼ è¿›å»å³å¯

### ç±»ä¼¼vueçš„ä½œç”¨åŸŸæ’æ§½å†™æ³•

> å‚è€ƒï¼š<https://zhuanlan.zhihu.com/p/427114998?utm_id=0>

```jsx
function Container(props) {
  return (
    <>
      {/* æ¥æ”¶åˆ°çš„å€¼åœ¨è¯¥å¤„æ¸²æŸ“ */}
      {props.children({ a: 1, b: 2, c: 3 })}
      {props.children({ e: 1, b: 2, c: 3 })}
      <input></input>
      <input></input>
      {props.children({ d: 1, b: 2, c: 3 })}
      <input></input>
    </>
  );
}

function C2ontainer(props) {
  return (
    <>
      <div>
        <input />
        <input />
        <input />
        <input />
      </div>
    </>
  );
}

export default function App() {
  return (
    <>
      <Container>
        {/* 
        é€šè¿‡ä¼ é€’å‡½æ•°å®ç°ä½œç”¨åŸŸæ’æ§½ï¼š
        å°†ä¸‹é¢çš„å†…å®¹æ›¿æ¢æˆconteinerå†…éƒ¨çš„props.childrenä½ç½®ä¸Šçš„å†…å®¹ï¼Œå¯ä»¥è¿”å›ä»»æ„å†…å®¹ 
        å…¶ä¸­ï¼Œæ¯ä¸ªvéƒ½ä»£è¡¨ä¸€ä¸ªprops.children
        */}
        {(v) =>
          Object.keys(v).map((item) => {
            return (
              <li key={item}>
                {v[item]}: {item}
                <C2ontainer />
              </li>
            );
          })
        }
      </Container>
    </>
  );
}

```

## å¿ƒå¾—

ä¼ å…¥ç»„ä»¶çš„propså˜æ›´ã€ç»„ä»¶çš„keyå±æ€§å˜æ›´ã€ç»„ä»¶å†…çš„stateå˜æ›´ã€ç»„ä»¶å†…ç”±è‡ªå®šä¹‰hooksåˆ›å»ºçš„å˜é‡çš„å˜æ›´ã€ç»„ä»¶å†…ä½¿ç”¨çš„contextå€¼å˜æ›´ã€ç»„ä»¶çš„çˆ¶ç»„ä»¶é‡æ¸²æŸ“ï¼Œéƒ½ä¼šè§¦å‘ç»„ä»¶çš„é‡æ¸²æŸ“

åœ¨è§¦å‘ç»„ä»¶é‡æ¸²æŸ“æ—¶ï¼Œç»„ä»¶é¡¶å±‚ä½œç”¨åŸŸå†…çš„**è¯­å¥**éƒ½ä¼šé‡æ–°æ‰§è¡Œ => å½“ä¸€ä¸ªå˜é‡æ˜¯å¯¹è±¡æ—¶ï¼Œè¯¥å˜é‡çš„åœ°å€ï¼Œä»¥åŠå…¶ä»–é¡¶å±‚å‡½æ•°çš„åœ°å€ä¼šå‘ç”Ÿå˜æ›´ => è‹¥è¯¥å˜é‡/å‡½æ•°ä¹Ÿæ˜¯useEffectçš„ä¾èµ–é¡¹ï¼Œåˆ™ä¼šè§¦å‘useEffectçš„æ‰§è¡Œï¼Œè¿™å°†å¯¼è‡´ä¸€äº›å¼‚å¸¸çš„æƒ…å†µï¼ˆæ¯”å¦‚æœ¬åº”è¯¥ä¸æ‰§è¡Œçš„å´æ‰§è¡Œäº†ï¼‰å‘ç”Ÿã€‚æ‰€ä»¥åº”è¯¥é¿å…å¯¹è±¡ï¼ˆå˜é‡ã€å‡½æ•°ï¼‰ä½œä¸ºuseEffectçš„ä¾èµ–é¡¹

## é™„å½•

### ä¸“æœ‰åè¯

**å¤–éƒ¨ç³»ç»Ÿ**ï¼šä¸å— react æ§åˆ¶çš„ä»£ç ï¼Œæ¯”å¦‚ç½‘ç»œã€æŸäº›æµè§ˆå™¨ APIï¼ˆinterval å®šæ—¶å™¨ã€eventListener ä¾¦å¬å™¨ï¼‰ã€ç¬¬ä¸‰æ–¹åº“

```

```
