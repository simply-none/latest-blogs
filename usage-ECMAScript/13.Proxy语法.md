# Proxy

## åŸºæœ¬æ¦‚å¿µ

1. ç›®çš„ï¼š
   1. ç”¨äºŽä¿®æ”¹æŸäº›æ“ä½œçš„é»˜è®¤è¡Œä¸ºï¼Œç­‰åŒäºŽåœ¨è¯­è¨€å±‚é¢è¿›è¡Œä¿®æ”¹ï¼Œå±žäºŽä¸€ç§å…ƒç¼–ç¨‹ï¼ˆå¯¹ç¼–ç¨‹è¯­è¨€è¿›è¡Œç¼–ç¨‹ï¼‰
   2. åœ¨ç›®æ ‡å¯¹è±¡ä¹‹å‰è¿›è¡Œæž¶è®¾ä¸€å±‚æ‹¦æˆªï¼Œå¤–ç•Œå¯¹è¯¥å¯¹è±¡çš„è®¿é—®ï¼Œå¿…é¡»é€šè¿‡è¯¥å±‚æ‹¦æˆªï¼Œæä¾›äº†å¯¹å¯¹è±¡çš„è®¿é—®è¿‡æ»¤å’Œæ”¹å†™çš„æ“ä½œ
2. Proxy å¯¹è±¡ï¼š
   1. ç”Ÿæˆ Proxy å®žä¾‹ï¼šnew Proxy(target, handler)ï¼Œå…¶ä¸­ target è¡¨ç¤ºè¦æ‹¦æˆªçš„ç›®æ ‡å¯¹è±¡ï¼Œhandler æ˜¯ä¸€ä¸ªå®šä¹‰æ‹¦æˆªè¡Œä¸ºçš„é…ç½®å¯¹è±¡
   2. è¦ä½¿æ‹¦æˆªç”Ÿæ•ˆï¼Œå¿…é¡»å¯¹ Proxy å®žä¾‹è¿›è¡Œæ“ä½œï¼Œè€Œéžç›®æ ‡å¯¹è±¡ target
   3. è‹¥ handler é…ç½®å¯¹è±¡æ— ä»»ä½•æ‹¦æˆªï¼Œç­‰åŒäºŽç›´æŽ¥é€šå‘åŽŸå¯¹è±¡
   4. Proxy å®žä¾‹å¯ä»¥ä½œä¸ºå…¶ä»–å¯¹è±¡çš„åŽŸåž‹ï¼Œè‹¥å®šåˆ¶äº†ä¸€ä¸ª get æ‹¦æˆªæ“ä½œï¼Œåˆ™è¯¥å¯¹è±¡çš„å±žæ€§è®¿é—®æ“ä½œåœ¨è¯¥å±žæ€§ä¸å­˜åœ¨æ—¶ï¼Œå°†ä»ŽåŽŸåž‹é“¾ä¸­è¯»å–ï¼Œæ­¤æ—¶è¯»å–æ“ä½œå°†è¢«æ‹¦æˆª
   5. ä¸€ä¸ªé…ç½®å¯¹è±¡ä¸­ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªä¸åŒçš„æ‹¦æˆªæ“ä½œ

## proxy å®žä¾‹æ–¹æ³•ï¼ˆé…ç½®å¯¹è±¡ handler ä¸­ï¼‰

1. get(target, propKey, receiver)
   1. ç”¨äºŽæ‹¦æˆªå¯¹è±¡å±žæ€§çš„è¯»å–ï¼Œæ¯”å¦‚ proxy.foo å’Œ proxy['foo']
   2. å…¶ä¸­å‚æ•°ä¾æ¬¡ä¸ºç›®æ ‡å¯¹è±¡ï¼Œå±žæ€§åï¼Œproxy å®žä¾‹æœ¬èº«ï¼ˆä¸¥æ ¼è¯´æ˜¯æ“ä½œè¡Œä¸ºé’ˆå¯¹çš„å¯¹è±¡ï¼Œå¯çœç•¥ï¼‰
   3. receiver æŒ‡å‘è°ƒç”¨å®ƒçš„é‚£ä¸ªå¯¹è±¡
   4. è‹¥å¯¹è±¡çš„æŸå±žæ€§ä¸å¯é…ç½®ï¼ˆconfigurableï¼‰ã€ä¸å¯å†™ï¼ˆwritableï¼‰ï¼Œåˆ™é€šè¿‡ proxy ä¿®æ”¹è¯¥å±žæ€§çš„è¯»æ“ä½œåŽï¼Œè®¿é—®è¯¥å±žæ€§å°†ä¼šæŠ¥é”™
   5. get æ–¹æ³•å¯ç»§æ‰¿ï¼Œè‹¥è¯»å–å¯¹è±¡ç»§æ‰¿çš„å±žæ€§ï¼ˆæˆ–ä¸å­˜åœ¨çš„å±žæ€§ï¼Œä»ŽåŽŸåž‹é“¾ä¸­æŸ¥æ‰¾ï¼‰æ—¶ï¼Œæ‹¦æˆªä¼šç”Ÿæ•ˆ ðŸ¥ƒ
   6. å®žçŽ°å±žæ€§çš„é“¾å¼æ“ä½œ ðŸ¡
   7. å®žçŽ°ç”Ÿæˆ dom èŠ‚ç‚¹çš„é€šç”¨å‡½æ•° ðŸ§
2. set(target, propKey, value, receiver)
   1. ç”¨äºŽæ‹¦æˆªå¯¹è±¡å±žæ€§çš„èµ‹å€¼æ“ä½œï¼Œæ¯”å¦‚ proxy.foo = 'jade'å’Œ proxy['foo'] = 'jade'ï¼Œè¿”å›žä¸€ä¸ªå¸ƒå°”å€¼
   2. å…¶ä¸­å‚æ•°ä¾æ¬¡ä¸ºç›®æ ‡å¯¹è±¡ï¼Œå±žæ€§åï¼Œå±žæ€§å€¼ï¼Œproxy å®žä¾‹æœ¬èº«ï¼ˆä¸¥æ ¼è¯´æ˜¯æ“ä½œè¡Œä¸ºé’ˆå¯¹çš„å¯¹è±¡ï¼Œå¯çœç•¥ï¼‰
   3. è‹¥ç›®æ ‡å¯¹è±¡è‡ªèº«çš„æŸä¸ªå±žæ€§ä¸å¯å†™ï¼Œåˆ™ set å°†ä¸èµ·ä½œç”¨
   4. set åº”è¯¥è¿”å›žå¸ƒå°”å€¼ã€‚ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œè‹¥æœªè¿”å›ž trueï¼Œå°†ä¼šæŠ¥é”™
   5. å¯ç”¨äºŽä¿è¯å±žæ€§å€¼ç¬¦åˆè®¾å®šçš„éœ€æ±‚ï¼Œä¸ç„¶å¯ä»¥æŠ›å‡ºå¼‚å¸¸
   6. å¯ç”¨äºŽä¿æŠ¤å†…éƒ¨ç§æœ‰å±žæ€§ä¸è¢«è¯»å–/è®¾ç½®ï¼Œç¦æ­¢ç§æœ‰å±žæ€§è¢«è¯»å–ï¼Œä¸ç„¶å¯ä»¥æ‹¦æˆªå¹¶æŠ›å‡ºå¼‚å¸¸ ðŸ–
3. has(target, propKey)
   1. æ‹¦æˆª propKey in target æ“ä½œï¼Œè¿”å›žä¸€ä¸ªå¸ƒå°”å€¼
   2. åˆ¤æ–­å¯¹è±¡æ˜¯å¦å…·æœ‰æŸä¸ªå±žæ€§æ—¶ï¼Œè¯¥æ–¹æ³•ä¼šç”Ÿæ•ˆ
   3. åŽŸå¯¹è±¡ä¸å¯é…ç½®/æ‰©å±•æ—¶ï¼Œè¯¥æ–¹æ³•ä¼šæŠ¥é”™
   4. has æ‹¦æˆªçš„æ˜¯ hasProperty æ“ä½œï¼Œä¸åŒºåˆ†è‡ªèº«çš„å±žæ€§å’Œç»§æ‰¿çš„å±žæ€§
   5. has å¯¹ for...in ä¸ä¼šç”Ÿæ•ˆ
4. defineProperty(target, propKey, propDesc)
   1. æ‹¦æˆª Object.defineProperty(target, propkey, propDesc)å’Œ Object.defineProperties(target, propdescs)ï¼Œè¿”å›žä¸€ä¸ªå¸ƒå°”å€¼
   2. è¿”å›žçš„å¸ƒå°”å€¼ä»…ä»…æ˜¯ç”¨äºŽæç¤ºæ“ä½œæˆåŠŸä¸Žå¦ï¼Œå¹¶ä¸èƒ½é˜»æ­¢æ·»åŠ æ–°çš„å±žæ€§
   3. è‹¥ç›®æ ‡å¯¹è±¡ target ä¸å¯æ‰©å±•ï¼Œåˆ™ä¸èƒ½æ·»åŠ ä¸å­˜åœ¨çš„å±žæ€§
   4. è‹¥ç›®æ ‡å¯¹è±¡ target ä¸­çš„æŸå±žæ€§ä¸å¯é…ç½®ï¼ˆconfigurableï¼‰/ä¸å¯å†™ï¼ˆwriteableï¼‰ï¼Œåˆ™è¯¥æ–¹æ³•ä¸èƒ½æ”¹å˜è¿™ä¸¤ä¸ªé…ç½®
5. deleteProperty(target, propKey)
   1. æ‹¦æˆª delete proxy[propKey]æ“ä½œï¼Œè¿”å›žä¸€ä¸ªå¸ƒå°”å€¼
   2. è¯¥æ–¹æ³•æŠ›å‡ºé”™è¯¯ï¼Œæˆ–è€…è¿”å›ž falseï¼Œåˆ™æ— æ³•åˆ é™¤è¯¥å±žæ€§
   3. ç›®æ ‡å¯¹è±¡ target è‡ªèº«çš„ä¸å¯é…ç½®å±žæ€§ï¼Œä¸èƒ½è¢«è¯¥æ–¹æ³•åˆ é™¤ï¼Œä¼šæŠ¥é”™
6. getOwnPropertyDescriptor(target, propKey)
   1. æ‹¦æˆª Object.getOwnPropertyDescriptorï¼Œè¿”å›žå±žæ€§çš„æè¿°å¯¹è±¡/undefined
7. isExtensible(target)
   1. æ‹¦æˆª Object.isExtensibleï¼Œè¿”å›žä¸€ä¸ªå¸ƒå°”å€¼
   2. è¯¥æ–¹æ³•åªèƒ½è¿”å›žå¸ƒå°”å€¼ï¼Œå¦åˆ™ä¼šè‡ªåŠ¨è½¬ä¸ºå¸ƒå°”å€¼
   3. è¯¥æ–¹æ³•æœ‰ä¸€ä¸ªå¼ºé™åˆ¶ï¼Œä»–çš„è¿”å›žå€¼å¿…é¡»ä¸Žç›®æ ‡å¯¹è±¡ï¼ˆnew Proxy çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰çš„ isExtensible å±žæ€§ä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¼šæŠ›å‡ºé”™è¯¯
8. preventExtensions(target)
   1. æ‹¦æˆª Object.preventExtensionsï¼Œè¿”å›žä¸€ä¸ªå¸ƒå°”å€¼ï¼Œéžå¸ƒå°”å€¼ä¼šè‡ªåŠ¨è½¬ä¸ºå¸ƒå°”å€¼
   2. åªæœ‰å¯¹è±¡ä¸å¯æ‰©å±•æ—¶ï¼Œæ‰èƒ½è¿”å›ž trueï¼Œå¦åˆ™ä¼šæŠ¥é”™
9. ownKeys(target)
   1. æ‹¦æˆª Object.getOwnPropertyNamesã€Object.getOwnPropertySymbolsã€Object.keysã€for...in å¾ªçŽ¯ï¼Œè¿”å›žä¸€ä¸ªä»…åŒ…å«å¯¹è±¡è‡ªèº«çš„å¯éåŽ†çš„å±žæ€§åæ•°ç»„
   2. ç›®æ ‡å¯¹è±¡ä¸å­˜åœ¨çš„å±žæ€§ã€å±žæ€§åä¸º Symbol çš„å±žæ€§ã€ä¸å¯éåŽ†çš„å±žæ€§ä¼šè¢«è¯¥æ–¹æ³•è‡ªåŠ¨è¿‡æ»¤ï¼Œä¸ä¼šå‡ºçŽ°åœ¨è¿”å›žç»“æžœä¸­ï¼ˆè¿”å›žç»“æžœä¼šè‡ªåŠ¨è¿‡æ»¤ä¸Šè¿°å±žæ€§ï¼‰ðŸ¥­
   3. è¿”å›žçš„æ•°ç»„å…ƒç´ åªèƒ½æ˜¯å­—ç¬¦ä¸²/symbol å€¼ï¼Œè‹¥è¿”å›žçš„æ˜¯å…¶ä»–ç±»åž‹ï¼Œæˆ–è¿”å›žçš„æ•°ç»„å…ƒç´ åŒ…æ‹¬å…¶ä»–ç±»åž‹ï¼Œå°†ä¼šæŠ¥é”™
   4. è‹¥ç›®æ ‡å¯¹è±¡åŒ…å«ä¸å¯é…ç½®çš„å±žæ€§ï¼Œåˆ™å¿…é¡»è¿”å›žè¯¥å±žæ€§ï¼Œå¦åˆ™ä¼šæŠ¥é”™
   5. è‹¥ç›®æ ‡å¯¹è±¡æ˜¯ä¸å¯æ‰©å±•çš„ï¼Œåˆ™å¿…é¡»ä»…èƒ½è¿”å›žè¯¥å¯¹è±¡çš„æ‰€æœ‰å±žæ€§ï¼Œä¸èƒ½åŒ…æ‹¬å…¶ä»–å±žæ€§ï¼Œå¦åˆ™ä¼šæŠ¥é”™
10. construct(target, args, newTarget)
    1. æ‹¦æˆª proxy å®žä¾‹ä½œä¸ºå‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚ new Proxy(...args)
    2. å…¶ä¸­å‚æ•°ä¸ºç›®æ ‡å¯¹è±¡ï¼Œæž„é€ å‡½æ•°çš„å‚æ•°æ•°ç»„ï¼Œnew å‘½ä»¤ä½œç”¨çš„æž„é€ å‡½æ•°
    3. è¯¥æ–¹æ³•å¿…é¡»è¿”å›žä¸€ä¸ªå¯¹è±¡ï¼Œå¦åˆ™ä¼šæŠ¥é”™
    4. target å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™
    5. è¯¥æ–¹æ³•å†…éƒ¨çš„ this æŒ‡å‘çš„æ˜¯ handler é…ç½®å¯¹è±¡ï¼Œè€Œéžå®žä¾‹å¯¹è±¡
11. getPrototypeOf(target)
    1. æ‹¦æˆª Object.getPrototypeOfï¼ŒReflect.getPrototypeOfï¼Œinstanceofï¼ŒObject.prototype.**proto**ï¼ŒObject.prototype.isPrototypeOfï¼Œè¿”å›žä¸€ä¸ªå¯¹è±¡/null
    2. è¯¥æ–¹æ³•çš„è¿”å›žå€¼å¿…é¡»æ˜¯å¯¹è±¡/nullï¼Œå¦åˆ™ä¼šæŠ¥é”™
    3. è‹¥ç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼Œåˆ™å¿…é¡»è¿”å›žç›®æ ‡å¯¹è±¡çš„åŽŸåž‹å¯¹è±¡
12. setPrototypeOf(target, proto)
    1. æ‹¦æˆª Object.setPrototypeOf(target, proto)ï¼Œè¿”å›žä¸€ä¸ªå¸ƒå°”å€¼ï¼Œæˆ–è¢«è‡ªåŠ¨è½¬ä¸ºå¸ƒå°”å€¼
    2. è‹¥ç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼Œåˆ™è¯¥æ–¹æ³•ä¸å¯æ”¹å˜ç›®æ ‡å¯¹è±¡çš„åŽŸåž‹
    3. è‹¥ç›®æ ‡å¯¹è±¡æ˜¯å‡½æ•°ï¼Œåˆ™è¿˜æœ‰ä¸¤ç§æ“ä½œæ–¹å¼ä¼šè¢«æ‹¦æˆª
13. apply(target, object, args)
    1. æ‹¦æˆª proxy å®žä¾‹ä½œä¸ºå‡½æ•°è°ƒç”¨ã€callã€apply çš„æ“ä½œï¼Œæ¯”å¦‚ proxy(...args)ã€proxy.call(object, ...args)ã€proxy.apply(...)ðŸ‡
    2. å…¶ä¸­å‚æ•°ä¸ºç›®æ ‡å¯¹è±¡ã€ç›®æ ‡å¯¹è±¡çš„ä¸Šä¸‹æ–‡å¯¹è±¡ thisã€ç›®æ ‡å¯¹è±¡çš„å‚æ•°æ•°ç»„

```js
// ðŸ¥ƒï¼šgetç»§æ‰¿
let proto = new Proxy(
  {},
  {
    get(target, propertyKey, receiver) {
      console.log("GET: " + propertyKey);
      return target[propertyKey];
    },
  }
);

let obj = Object.create(proto);
obj.name; // 'GET: name'

// ðŸ¡ï¼šgeté“¾å¼æ“ä½œ
const pipe = function (value) {
  const fullStack = [];
  const proxy = new Proxy(
    {},
    {
      get: function (pipeObj, fnName) {
        if (fnName === "get") {
          return fullStack.reduce(function (val, fn) {
            return fn(val);
          }, value);
        }
        fullStack.push(window[fnName]);
        return proxy;
      },
    }
  );
  return proxy;
};

const double = (n) => n * 2;
const pow = (n) => n * n;
const reverseInt = (n) => n.toString().split("").reverse().join("") | 0;

pipe(3).double.pow.reverseInt.get; // 63

// ðŸ§ï¼šgetå®žçŽ°é€šç”¨domèŠ‚ç‚¹ç”Ÿæˆå‡½æ•°
const dom = new Proxy(
  {},
  {
    get(target, property) {
      return function (attrs = {}, ...children) {
        const el = document.createElement(property);
        for (let prop of Object.keys(attrs)) {
          el.setAttribute(prop, attrs[prop]);
        }
        for (let child of children) {
          if (typeof child === "string") {
            child = document.createTextNode(child);
          }
          el.appendChild(child);
        }
        return el;
      };
    },
  }
);

const el = dom.div(
  {},
  "Hello, my name is ",
  dom.a({ href: "//example.com" }, "Mark"),
  ". I like:",
  dom.ul(
    {},
    dom.li({}, "The web"),
    dom.li({}, "Food"),
    dom.li({}, "actually it's it")
  )
);

document.body.appendChild(el);

// ðŸ–ï¼šsetç¦æ­¢ç§æœ‰å±žæ€§è¢«è¯»å–
const handler = {
  get(target, key) {
    invariant(key, "get");
    return target[key];
  },
  set(target, key, value) {
    invariant(key, "set");
    target[key] = value;
    return true;
  },
};

function invariant(key, action) {
  if (key[0] === "_") {
    throw new Error(`invariant attempt to ${action} private "${key}" property`);
  }
}

const target = {};
const proxy = new Proxy(target, handler);
proxy._prop; // Error: Invalid attempt to get private "_prop" property
proxy._prop = "c"; // Error: Invalid attempt to set private "_prop" property

// ðŸ‡ï¼šapplyç”¨æ³•
const twice = {
  apply(target, ctx, args) {
    return Reflect.apply(...arguments) * 2;
  },
};

function sum(left, right) {
  return left + right;
}

const proxy = new Proxy(sum, twice);
proxy(1, 2); // 6
proxy.call(null, 3, 4); // 14
proxy.apply(null, [5, 6]); // 22
// ç›´æŽ¥è°ƒç”¨ä¸‹é¢å¼å­ï¼Œä¹Ÿä¼šè¢«æ‹¦æˆª
Reflect.apply(proxy, null, [7, 8]); // 30

// ðŸ¥­ï¼šownKeysè¿‡æ»¤å±žæ€§
let target = {
  a: 1,
  b: 2,
  c: 3,
  [Symbol.for("secret")]: "4",
};

Object.defineProperty(target, "key", {
  enumerable: false,
  configurable: true,
  writable: true,
  value: "static",
});

let handler = {
  ownKeys(target) {
    // æœ¬æ¥ä¼šè¿”å›žæ•°ç»„ï¼š['a', 'd', Symbol.for('secret'), 'key']
    // ç”±äºŽdï¼ˆä¸å­˜åœ¨ï¼‰, Symbol.for('secret')ï¼ˆsymbolå±žæ€§ï¼‰, keyï¼ˆä¸å¯éåŽ†å±žæ€§ï¼‰ä¼šè¢«è‡ªåŠ¨è¿‡æ»¤
    // æ‰€ä»¥ä¸‹è¿°è¿”å›žï¼š['a']
    return ["a", "d", Symbol.for("secret"), "key"];
  },
};

let proxy = new Proxy(target, handler);

Object.keys(proxy);
// ['a']
```

## Proxy.revocable(target, handle)

1. è¯¥æ–¹æ³•è¿”å›ž{ proxy, revoke }ï¼Œå…¶ä¸­proxyè¡¨ç¤ºproxyå®žä¾‹ï¼Œrevokeæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥å–æ¶ˆproxyå®žä¾‹
2. å½“æ‰§è¡Œäº†revoke()åŽï¼Œå†æ¬¡è®¿é—®proxyå®žä¾‹ï¼Œå°†ä¼šæŠ¥é”™
3. ä½¿ç”¨åœºæ™¯ï¼šç›®æ ‡å¯¹è±¡ä¸å…è®¸ç›´æŽ¥è®¿é—®ï¼Œå¿…é¡»é€šè¿‡ä»£ç†è®¿é—®ï¼Œä¸€æ—¦è®¿é—®ç»“æŸï¼Œåˆ™æ”¶å›žä»£ç†æƒï¼Œä¸å…è®¸å†æ¬¡è®¿é—®

## thisçš„é—®é¢˜

1. proxyè™½ç„¶å¯ä»¥ä»£ç†é’ˆå¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®ï¼Œä½†ä»–ä¸æ˜¯ç›®æ ‡å¯¹è±¡çš„é€æ˜Žä»£ç†ï¼Œå³ä½¿ä¸åšä»»ä½•æ‹¦æˆªï¼Œä¹Ÿæ— æ³•ä¸Žç›®æ ‡å¯¹è±¡çš„è¡Œä¸ºä¿æŒä¸€è‡´ï¼Œ**å› ä¸ºåœ¨proxyä»£ç†çš„æƒ…å†µä¸‹ï¼Œç›®æ ‡å¯¹è±¡ä¸­çš„thiså…³é”®å­—ä¼šæŒ‡å‘è°ƒç”¨æ“ä½œæ‰€å±žçš„å¯¹è±¡ï¼ˆå¯èƒ½æ˜¯ç›®æ ‡å¯¹è±¡ï¼Œä¹Ÿå¯èƒ½æ˜¯proxyå®žä¾‹ï¼‰**ðŸ§ƒ
2. æœ‰äº›åŽŸç”Ÿå¯¹è±¡çš„å±žæ€§ï¼Œåªæœ‰é€šè¿‡æ­£ç¡®çš„thisæ‰èƒ½å¤Ÿæ‹¿åˆ°ï¼Œæ‰€ä»¥proxyæ— æ³•ä»£ç†åŽŸç”Ÿå¯¹è±¡çš„å±žæ€§ï¼Œé™¤éžå°†thisç»‘å®šåŽŸç”Ÿå¯¹è±¡ðŸŒ®
3. proxyæ‹¦æˆªå‡½æ•°å†…éƒ¨çš„thisï¼ŒæŒ‡å‘çš„æ˜¯handlerå¯¹è±¡

```js
// ðŸ§ƒï¼šthisçš„æŒ‡å‘
const _name = new WeakMap();

class Person {
  constructor(name) {
    _name.set(this, name);
  }
  get name() {
    return _name.get(this);
  }
}

const jane = new Person('Jane');  // æ­¤æ—¶ä¼šè°ƒç”¨constructorå‡½æ•°ï¼Œå¹¶ä¸”thisæŒ‡å‘personå®žä¾‹
jane.name // 'Jane'ï¼Œæ‰€ä»¥æ­¤åˆ»èƒ½å¤Ÿè®¿é—®åˆ°nameå±žæ€§

const proxy = new Proxy(jane, {});    // æ­¤æ—¶janeåŒ…æ‹¬nameå±žæ€§
proxy.name // undefinedï¼Œè°ƒç”¨æ—¶ï¼Œè°ƒç”¨å–å€¼å‡½æ•°getterï¼Œæ­¤æ—¶thisæŒ‡å‘proxyå®žä¾‹ï¼Œç”±äºŽproxyå®žä¾‹ä¸åŒ…å«nameå±žæ€§ï¼Œæ‰€ä»¥å€¼ä¸ºundefined

// ðŸŒ®ï¼šåŽŸç”Ÿå¯¹è±¡ç»‘å®šthis
const target = new Date('2015-01-01');
const handler = {
  get(target, prop) {
    if (prop === 'getDate') {
      // ç»‘å®šthisåˆ°åŽŸç”Ÿå¯¹è±¡
      return target.getDate.bind(target);
    }
    return Reflect.get(target, prop);
  }
};
const proxy = new Proxy(target, handler);

proxy.getDate() // 1
```

## å®žä¾‹ï¼šwebæœåŠ¡çš„å®¢æˆ·ç«¯

1. proxyå¯¹è±¡å¯ä»¥æ‹¦æˆªç›®æ ‡å¯¹è±¡çš„ä»»ä½•å±žæ€§ï¼Œæ•…è€Œå¯ä»¥ç”¨äºŽç¼–å†™webæœåŠ¡çš„å®¢æˆ·ç«¯

```js
function createWebService(baseUrl) {
  return new Proxy({}, {
    get(target, propKey, receiver) {
      return () => httpGet(baseUrl + '/' + propKey);
    }
  });
}

const service = createWebService('http://example.com/data');

service.employees().then(json => {
  const employees = JSON.parse(json);
  // Â·Â·Â·
});
```