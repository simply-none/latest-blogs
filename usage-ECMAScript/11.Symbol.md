# Symbolçš„ç”¨æ³•

å¼•å…¥åŸå› ï¼šé¿å…å±æ€§åå†²çªï¼Œä¿è¯æ¯ä¸ªå±æ€§åç‹¬ä¸€æ— äºŒ

JavaScriptçš„æ•°æ®ç±»å‹ï¼šundefinedã€nullã€Booleanã€Numberã€Stringã€Symbolã€Object

å¯¹è±¡å±æ€§åçš„ä¸¤ç§å½¢å¼ï¼šå­—ç¬¦ä¸²ã€Symbolç±»å‹

## åŸºç¡€çŸ¥è¯†

1. `Symbol()`ï¼šç”ŸæˆSymbolå€¼
   1. å¯æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œè¡¨ç¤ºSymbolå®ä¾‹çš„æè¿°ï¼ŒåŠ å…¥çš„ç›®çš„æ˜¯æ–¹ä¾¿åŒºåˆ†å„ä¸ªSymbolå€¼
   2. è‹¥å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°†è°ƒç”¨å¯¹è±¡çš„toStringæ–¹æ³•è½¬ä¸ºå­—ç¬¦ä¸²å½¢å¼ï¼Œæ¯”å¦‚Objectå¯¹è±¡è°ƒç”¨æ–¹æ³•ä¼šç”Ÿæˆ`[object Object]`
   3. ç”±äºSymbolå€¼æ˜¯ä¸€ä¸ªåŸå§‹ç±»å‹ï¼Œè€Œéå¯¹è±¡ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨newç­‰å‘½ä»¤
   4. æ¯ä¸ªä½¿ç”¨è¯¥å‡½æ•°ç”Ÿæˆçš„Symbolå€¼éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„
   5. Symbolå€¼ä¸èƒ½ä¸å…¶ä»–å€¼è¿›è¡Œè¿ç®—ï¼Œæ¯”å¦‚è½¬ä¸ºå­—ç¬¦ä¸²å½¢å¼ï¼ˆä¸å­—ç¬¦ä¸²ä½¿ç”¨+å·ã€ä½¿ç”¨åå¼•å·å¼•å…¥symbolã€newæ„é€ å‡½æ•°ï¼‰ã€è½¬ä¸ºæ•°å­—ä¼šæŠ¥ç±»å‹é”™è¯¯
   6. Symbolå¯æ˜¾å¼è½¬ä¸ºå­—ç¬¦ä¸²å½¢å¼ï¼ˆä½¿ç”¨String()ã€toString()ï¼‰ï¼Œå¯ä»¥è½¬ä¸ºBoolean
   7. æ¯ä¸ªsymbolå€¼éƒ½æ˜¯ä¸ç›¸ç­‰çš„ï¼Œæ‰€ä»¥symbolå¯ä»¥ä½œä¸ºæ ‡è¯†ç¬¦ï¼Œç”¨äºå¯¹è±¡çš„å±æ€§å(é€šè¿‡æ–¹æ‹¬å·/å®šä¹‰å±æ€§çš„æ–¹å¼æŒ‡å®šå±æ€§å)ï¼Œèƒ½å¤Ÿé˜²æ­¢é”®åè¢«æ”¹å†™/è¦†ç›–ï¼Œå†™æ³•å¦‚ï¼šğŸŠ
   8. Symbolç±»å‹å¯ä»¥ç”¨æ¥å®šä¹‰ä¸€ç»„å¸¸é‡ï¼Œä¿è¯è¿™ç»„å¸¸é‡çš„å€¼éƒ½æ˜¯ä¸ç›¸ç­‰çš„ï¼Œæ¯”å¦‚ç”¨åœ¨switchè¯­å¥ä¸­ğŸ§ƒ
   9. Symbolä½œä¸ºå±æ€§åæ—¶ï¼Œæ˜¯ä¸€ä¸ªå…¬å¼€å±æ€§
   10. symbolå¯æ¶ˆé™¤**é­”æœ¯å­—ç¬¦ä¸²**ï¼ˆåœ¨ä»£ç ä¸­å¤šæ¬¡å‡ºç°ã€ä¸ä»£ç å½¢æˆå¼ºè€¦åˆçš„æŸäº›å…·ä½“çš„å­—ç¬¦ä¸²/æ•°å€¼ï¼‰ï¼Œè§„èŒƒä»£ç é£æ ¼ğŸ¥¦
   11. éå†symbolå€¼ï¼Œå¯ä»¥ç”¨`Object.getOwnPropertySymbols()`ã€`Reflect.ownKeys()`ï¼ˆè¿”å›æ‰€æœ‰çš„é”®åï¼‰è¿›è¡Œå±æ€§åçš„éå†
   12. ç”±äºå¸¸è§„æ–¹æ³•ä¸ä¼šéå†åˆ°symbolå€¼ï¼Œå¯ä»¥åˆ©ç”¨è¯¥ç‰¹æ€§ï¼Œå®šä¹‰ä¸€äº›éç§æœ‰çš„ï¼Œä½†å¸Œæœ›åªç”¨äºå†…éƒ¨çš„æ–¹æ³•
2. `Symbol.prototype.description`ï¼šè¿”å›symbolå€¼çš„æè¿°ï¼ˆå­—ç¬¦ä¸²çš„å‚æ•°ï¼‰
3. `Symbol.for()`ï¼šæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œå…¶ä»–ç±»å‹ä¼šè½¬ä¸ºå­—ç¬¦ä¸²
   1. è¡¨ç¤ºæ³¨å†Œä¸€ä¸ªsymbolå€¼åˆ°å…¨å±€ï¼Œä¹‹åè‹¥å†æ¬¡ä»¥è¯¥å‚æ•°æ³¨å†Œï¼Œä¼šè¿”å›ä¹‹å‰çš„å€¼
   2. åˆ©ç”¨å…¨å±€æ³¨å†Œçš„ç‰¹æ€§ï¼Œå¯ä»¥åœ¨ä¸åŒçš„iframeå’Œservice workerä¸­å–åˆ°åŒä¸€ä¸ªå€¼
4. `Symbol.keyFor()`ï¼šè¿”å›ä¸€ä¸ªå·²ç™»è®°çš„symbolç±»å‹å€¼çš„keyï¼ˆå‚æ•°ï¼‰ï¼Œè‹¥æ— å‚ï¼Œè¿”å›undefined


```js
// ğŸŠï¼šsymbolä½œä¸ºå¯¹è±¡çš„å±æ€§å

// ç¬¬ä¸€ç§å†™æ³•ï¼š
let s = Symbol()
let a = {}
a[s] = 'hello'

// ç¬¬äºŒç§å†™æ³•ï¼š
let s = Symbol()
let t = Symbol()
let a = {
  [s]: 'hello',
  [t] (arg) {
    // ...
  }
}

// ç¬¬ä¸‰ç§å†™æ³•ï¼š
let s = Symbol()
let a = {}
Object.defineProperty(a, s, {
  value: 'hello'
})

// ğŸ§ƒï¼šsymbolç”¨æ¥å®šä¹‰å¸¸é‡
const COLOR_RED = Symbol()
const COLOR_BLUE = Symbol()

function getComplete(color) {
  switch (color) {
    case COLOR_RED:
      return COLOR_BLUE
    case COLOR_BLUE:
      return COLOR_RED
    default:
      throw new Error('undefined color')
  }
}

// ğŸ¥¦ï¼šæ¶ˆé™¤é­”æ³•å­—ç¬¦ä¸²
const shapeType = {
  triangle: 'Triangle'
}

function getArea (shape, options) {
  let area = 0
  switch (shape) {
    // ä½¿ç”¨symbolå€¼ä»£æ›¿å¸¸è§„å¸¸é‡ï¼Œé¿å…å‡ºç°é­”æ³•å­—ç¬¦ä¸²ï¼Œæ­¤æ—¶å¹¶ä¸éœ€è¦çŸ¥é“è¯¥å€¼æ˜¯ä½•å€¼ï¼Œåªéœ€ç¡®ä¿ä¸å‘ç”Ÿå†²çªå³å¯
    case shapeType.triangle:
      area = .5 * options.width * options.height
      break
  }
  return area
}

// ä½¿ç”¨symbolå€¼ä»£æ›¿å¸¸è§„å¸¸é‡ï¼Œé¿å…å‡ºç°é­”æ³•å­—ç¬¦ä¸²
getArea(shapeType.triangle, { width: 3, height: 9})
```

## å†…ç½®çš„symbolå€¼

å®šä¹‰ï¼šéƒ½æŒ‡å‘è¯­è¨€å®šä¹‰çš„å†…éƒ¨æ–¹æ³•

1. `Symbol.hasInstance`ï¼šå½“å…¶ä»–å¯¹è±¡ä½¿ç”¨instanceofåˆ¤æ–­æ˜¯å¦ä¸ºè¯¥å¯¹è±¡çš„å®ä¾‹æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ª**æ–¹æ³•**ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ğŸ‹
2. `Symbol.isConcatSpreadable`ï¼šå¯¹è±¡çš„è¯¥**å±æ€§**ä¸ºä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå¯¹è±¡ç”¨äº`Array.prototype.concat`æ˜¯å¦å¯ä»¥å±•å¼€ğŸ‡
   1. å“ªä¸ªå¯¹è±¡è®¾ç½®äº†è¯¥å±æ€§ä¸ºfalseï¼Œåˆ™è¯¥å¯¹è±¡åœ¨å’Œconcatä¸€èµ·ä½¿ç”¨ï¼ˆè°ƒç”¨è¯¥æ–¹æ³•/æ–¹æ³•å‚æ•°å½¢å¼ï¼‰æ—¶ä¸å¯å±•å¼€
3. `Symbol.species`ï¼šæŒ‡å‘ä¸€ä¸ªæ„é€ å‡½æ•°ï¼ˆè¿”å›ä¸€ä¸ªæ„é€ å‡½æ•°ï¼‰ï¼Œå½“åˆ›å»ºè¡ç”Ÿå¯¹è±¡æ—¶ï¼Œè°ƒç”¨è¯¥**å±æ€§**ğŸ
   1. ä½œç”¨ï¼šå®ä¾‹å¯¹è±¡è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œéœ€è¦å†æ¬¡è°ƒç”¨è‡ªèº«çš„æ„é€ å‡½æ•°æ—¶ï¼Œä¼šè°ƒç”¨è¯¥å±æ€§æŒ‡å®šçš„æ„é€ å‡½æ•°
   2. ç”¨é€”ï¼šå½“å­ç±»ä½¿ç”¨ç»§æ‰¿çš„æ–¹æ³•æ—¶ï¼Œå¸Œæœ›è¿”å›åŸºç±»çš„å®ä¾‹ï¼Œè€Œéå­ç±»çš„
   3. è¡ç”Ÿå¯¹è±¡ï¼šæ¯”å¦‚ä½¿ç”¨æ•°ç»„açš„ä¸€äº›æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°æ•°ç»„bæ—¶ï¼Œbæ˜¯açš„è¡ç”Ÿå¯¹è±¡ï¼Œä¼šè°ƒç”¨aå®ä¾‹å¯¹åº”çš„å¯¹è±¡çš„è¯¥å±æ€§ï¼Œæ¯”å¦‚promiseçš„thenæ–¹æ³•
4. `Symbol.match`ï¼šæŒ‡å‘ä¸€ä¸ª**æ–¹æ³•**ï¼Œå½“æ‰§è¡Œ`str.match(myObj)`ç­‰äº`myobj[Symbol.match](this)`æ—¶ï¼Œä¼šè°ƒç”¨è¯¥å±æ€§ï¼Œè¿”å›è¯¥æ–¹æ³•çš„è¿”å›å€¼ğŸŒ¹
5. `Symbol.replace`ï¼šæŒ‡å‘ä¸€ä¸ª**æ–¹æ³•**ï¼Œå½“è¯¥å¯¹è±¡è¢«String.prototype.replaceè°ƒç”¨æ—¶ï¼Œè¿”å›è¯¥æ–¹æ³•çš„è¿”å›å€¼ğŸ€
6. `Symbol.search`ï¼šæŒ‡å‘ä¸€ä¸ª**æ–¹æ³•**ï¼Œå½“å¯¹è±¡è¢«String.prototype.searchè°ƒç”¨æ—¶ï¼Œè¿”å›è¯¥æ–¹æ³•çš„è¿”å›å€¼ğŸ
7. `Symbol.split`ï¼šæŒ‡å‘ä¸€ä¸ª**æ–¹æ³•**ï¼Œå½“å¯¹è±¡è¢«String.prototype.splitè°ƒç”¨æ—¶ï¼Œè¿”å›è¯¥æ–¹æ³•çš„è¿”å›å€¼ğŸ§
8. `Symbol.iterator`ï¼šæŒ‡å‘å¯¹è±¡é»˜è®¤çš„éå†å™¨æ–¹æ³•ï¼Œå½“å¯¹å¯¹è±¡è¿›è¡Œéå†æ—¶ï¼Œä¼šè°ƒç”¨è¯¥æ–¹æ³•ğŸ¥©
9. `Symbol.toPrimitive`ï¼šæŒ‡å‘ä¸€ä¸ªæ–¹æ³•ï¼Œå½“è¯¥å¯¹è±¡è¢«è½¬ä¸ºåŸå§‹ç±»å‹æ—¶ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè¿”å›è¯¥å¯¹è±¡åœ¨**å½“å‰åœºåˆ**å¯¹åº”çš„åŸå§‹ç±»å‹å€¼ğŸŒ·
   1.  è¢«è°ƒç”¨æ—¶ï¼Œå›æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºå½“å‰çš„è¿ç®—æ¨¡å¼ï¼Œå…±æœ‰ä¸‰ç§ï¼š
       1.  Numberï¼šè¯¥åœºåˆéœ€è¦è½¬ä¸ºæ•°å€¼
       2.  Stringï¼šè¯¥åœºåˆéœ€è¦è½¬ä¸ºå­—ç¬¦ä¸²
       3.  Defaultï¼šè¯¥åœºåˆå¯ä¸ºæ•°å€¼ï¼Œå¯ä¸ºå­—ç¬¦ä¸²
10. `Symbol.toStringTag`ï¼šæŒ‡å‘ä¸€ä¸ªå¯¹è±¡å±æ€§ï¼Œå½“å¯¹è±¡è°ƒç”¨String.prototype.toStringæ—¶ï¼Œè‹¥è¯¥å±æ€§å­˜åœ¨ï¼Œè¯¥å±æ€§çš„è¿”å›å€¼å›å‡ºç°åœ¨toStringæ–¹æ³•çš„å­—ç¬¦ä¸²ä¸­ï¼Œå³[object xxx]ğŸ§…
11. `Symbol.unscopables`ï¼šæŒ‡å‘å¯¹è±¡çš„å±æ€§ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡æŒ‡å®šäº†ä½¿ç”¨withå…³é”®å­—æ—¶ï¼Œå“ªäº›å±æ€§å¯ä»¥è¢«withç¯å¢ƒæ’é™¤ğŸœ

```js
// ğŸ‹ï¼šSymbol.hasInstance(æ–¹æ³•)
class MyClass {
  // è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆéå¸ƒå°”å€¼ä¼šè½¬ä¸ºå¸ƒå°”å€¼ï¼‰
  [Symbol.hasInstance](foo) {
    return foo instanceof Array
  }
}

// ä¸‹é¢çš„è¯­å¥ï¼Œå°†è°ƒç”¨`Foo[Symbol.hasInstance](foo)`
[1, 2, 3] instanceof new MyClass()

// ğŸ‡ï¼šSymbol.isConcatSpreadable(å±æ€§)
// 1. å®šä¹‰åœ¨å­—é¢é‡å¯¹è±¡ä¸Šï¼šå½“è¿æ¥ä¸€ä¸ªæ•°ç»„æ—¶ï¼Œé»˜è®¤ç­‰äºundefinedï¼Œä¸å€¼ä¸ºtrueæ—¶æ•ˆæœç›¸åŒ
let arr = ['a', 'b']
arr[Symbol.isConcatSpreadable] = false
['c', 'd'].concat(arr, 'e') // ['c', 'd', ['a', 'b'], 'e']

// 2. è¿æ¥ä¸€ä¸ªç±»æ•°ç»„å¯¹è±¡æ—¶ï¼Œé»˜è®¤ä¸ºfalse
let likeArr = { length: 2, 0: 'c', 1: 'd' }
likeArr[Symbol.isConcatSpreadable] = true
['a', 'b'].concat(likeArr, 'e') // ['a', 'b', 'c', 'd', 'e']

// 3. å®šä¹‰åœ¨ç±»ä¸­ï¼Œå®šä¹‰åœ¨å®ä¾‹ä¸­
class Arr extends Array {
  constructor (args) {
    super(args)
    this[Symbol.isConcatSpreadable] = false
  }
}

// 4. å®šä¹‰åœ¨ç±»ä¸­ï¼Œå®šä¹‰åœ¨ç±»æœ¬èº«ï¼Œæ•ˆæœå’Œ3ç›¸åŒ
class Arr extends Array {
  constructor (args) {
    super(args)
  }

  get [Symbol.isConcatSpreadable] () {
    return false
  }
}

// ğŸï¼šSymbol.species(å±æ€§)ï¼š
// è®¾ç½®è¯¥å±æ€§
class Arr extends Array {
  static get [Symbol.species] () {
    // æœªè®¾ç½®é»˜è®¤æŒ‡å‘çš„æ˜¯ä»–æœ¬èº«ï¼ˆä¹Ÿå°±æ˜¯thisï¼šArrï¼‰
    return Array
  }
}

// ğŸŒ¹ï¼šSymbol.match(æ–¹æ³•)ï¼š
String.prototype.match(regExp)
// ç­‰åŒäºï¼š
regExp[Symbol.match](this)

class MyClass {
  [Symbol.match] (str) {
    return 'hello world'.indexOf(str)
  }
}

'e'.match(new MyClass())  // 1

// ğŸ€ï¼šSymbol.replace(æ–¹æ³•)ï¼š
String.prototype.replace(searchVal, replaceVal)
// ç­‰åŒäºï¼š
searchVal[Symbol.replace(this, replaceVal)]

const x = {}
x[Symbol.replace] = (...s) => console.log(s)

'hello'.replace(x, 'world') // ['hello', 'world']
// ç­‰åŒäºï¼š
x[Symbol.replace]('hello', 'world')

// ğŸï¼šSymbol.search(æ–¹æ³•)ï¼š
String.prototype.search(regExp)
// ç­‰åŒäºï¼š
regExp[Symbol.search](this)

class MySearch {
  constructor (value) {
    this.value = value
  }
  [Symbol.search] (string) {
    return string.indexOf(this.value)
  }
}

'foo bar'.search(new MySearch('foo')) // 0

// ğŸ§ï¼šSymbol.split(æ–¹æ³•)ï¼š
String.prototype.split(sepatator, limit)
// ç­‰åŒäºï¼š
separator[Symbol.split](this, limit)

class MySplitter {
  constructor (value) {
    this.value = value
  }
  [Symbol.split] (string) {
    let index = string.indexOf(this.value)
    if (index === -1) {
      return string
    }
    return [
      string.subStr(0, index),
      string.subStr(index + this.value.length)
    ]
  }
}

'foobar'.split(new Mysplitter('foo'))   // ['', 'bar']
// ç­‰åŒäºï¼š
new Mysplitter('foo')[Symbol.split]('foobar')

// ğŸ¥©ï¼šSymbol.iterator(æ–¹æ³•)ï¼š
const myIterator = {}
myIterator[Symbol.iterator] = function* () {
  yield 1
  yield 2
  yield 3
}

[...myIterator] // [1, 2,3]

class Collection {
  *[Symbol.iterator] () {
    let i = 0
    while (this[i] !== undefined) {
      yield this[i]
      ++i
    }
  }
}

let myCollection = new Collection()
myCollection[0] = 1
myCollection[1] = 2
for (let i of myCollection) {
  console.log(i)
}

// 1
// 2

// ğŸŒ·ï¼šSymbol.toPrimitive
let obj = {
  [Symbol.toPrimitive] (hint) {
    switch (hint) {
      case 'number':
        return 123
      case 'string':
        return 'string'
      case 'default':
        return 'default'
      default:
        throw new Error()
    }
  }
}

2 * obj   // 246
2 + obj   // '2default'
obj === 'default'   // true
String(obj)   // 'string'


// ğŸ§…ï¼šSymbol.toStringTag
({ [Symbol.toStringTag]: 'foo' }.toString)  // [object foo]

class Collection {
  get [Symbol.toStringTag] () {
    return 'jade'
  }
}

let x = new Collection()
Object.prototype.toString.call(x)   // [object jade]

// ğŸœï¼šSymbol.unscopable
// æœªæŒ‡å®šè¯¥å±æ€§æ—¶
class MyClass {
  foo () {
    return 1
  }
}

var foo = function () {
  return 2
}

with (MyClass.prototype) {
  foo()   // 1
}

// æŒ‡å®šè¯¥å±æ€§æ—¶
class MyClass {
  foo () {
    return 1
  }
  get [Symbol.unscopables] () {
    return {
      foo: true
    }
  }
}

var foo = function () {
  return 2
}

// æ­¤æ—¶withè¯­å¥ä¸ä¼šåœ¨å½“å‰ä½œç”¨åŸŸå¯»æ‰¾fooå±æ€§ï¼Œè€Œæ˜¯æŒ‡å‘å¤–å±‚ä½œç”¨åŸŸ
with (MyClass.prototype) {
  foo()   // 2
}
```